<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="网站名称">
    <meta name="applicable-device" content="pc,mobile">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <title>BaiduMap | 百度地图实例化控件v2.0.0(测试版)</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link type="text/css" rel="stylesheet" href="assets/neatui/css/neatui.min.css"><!--前端框架-->
    <link type="text/css" rel="stylesheet" href="assets/neatui/css/neatui-dialog.css"><!--对话框-->
    <link type="text/css" rel="stylesheet" href="assets/neatui/css/neatui-bdmap.css"><!--百度地图控件-->
</head>

<body>
    <div class="bdmap" id="allmap">
        <div class="bdmap__editor">
            <div class="bdmap__picker">
                当前学校坐标 <input type="text" id="c-locate">
                <button type="button" data-type="copy" id="btn-pick-copy">复制</button>
                <button type="button" data-type="save" id="btn-pick-save">保存学校坐标</button>
                <label> (拖动标记点可更改坐标) </label>
            </div>
            <div class="bdmap__draw">
                <span>拖动多边形上的小正方形，可更改学区范围</span>
                <button type="button" data-type="del" id="btn-poly-del">删除学区范围</button>
                <button type="button" data-type="save" id="btn-poly-save">保存学区范围</button>
            </div><!--/.bdmap__draw-->
        </div><!--/.bdmap__editor-->
        <div class="bdmap__map">
            <div id="map"></div>
            <div class="bdmap__mouse">绘制学区范围</div>
            <div id="showPanelBtn">编辑多边形&lt;</div>
            <div id="panelWrap">
                <div id="showOverlayInfo">此处用于展示覆盖物信息</div>
                <div id="panel"></div>
            </div>
        </div><!--/.bdmap__map-->
    </div><!--/.allmap-->
    
    <div id="result">
        <dl>
            <dt>绘制工具功能</dt>
            <dd>
                <ul>
                    <li><label><input type="radio" name="openClose1" onclick="bdChinaMap.drawingManager.open()" />打开</label>
                        <label><input type="radio" name="openClose1" onclick="bdChinaMap.drawingManager.close()" checked="checked" />关闭</label></li>
                </ul>
            </dd>

            <dt>是否进行线或面积的计算(单位米)</dt>
            <dd>
                <ul>
                    <li>
                        <label><input type="radio" name="openClose" onclick="bdChinaMap.drawingManager.enableCalculate()">打开</label> 
                        <label><input type="radio" name="openClose" onclick="bdChinaMap.drawingManager.disableCalculate()" checked="checked">关闭</label>
                    </li>
                </ul>
            </dd>

            <dt>绘制功能</dt>
            <dd>
                <ul>
                    <li>
                        <label><input type="radio" name="drawmode"  onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_MARKER)" checked="checked">画点</label>
                        <input type="checkbox" id="isInfowindow"> 是否带信息窗口
                    </li>
                    <li>
                        <label><input type="radio" name="drawmode" onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_CIRCLE)">画圆</label>
                    </li>
                    <li>
                        <label><input type="radio" name="drawmode" onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_POLYLINE)">画线</label>
                    </li>
                    <li>
                        <label><input type="radio" name="drawmode" onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_POLYGON)">画多边形</label>
                    </li>
                    <li>
                        <label><input type="radio" name="drawmode" onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_RECTANGLE)">画矩形</label>
                    </li>
                </ul>
            </dd>

            <dt>覆盖物操作</dt>
            <dd>
                <ul>
                    <li>
                        <input type="button" value="获取绘制的覆盖物个数" onclick="bdChinaMap.getCount()" />
                        <input type="button" value="清除所有覆盖物" onclick="bdChinaMap.clearAll()" />
                        <input type="button" value="获取最后一个覆盖物信息" onclick="bdChinaMap.getOverLay()" />
                    </li>
                </ul>
            </dd>
        </dl>
    </div>
    

    <!--================================================================================-->
    <!--                            JAVASCRIPT                                          -->
    <!--================================================================================-->
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=2COzFaICuIyVj7V3VetKfmdRVnX8BhVr"></script><!--百度地图api文件 (这里要屏蔽)-->
    <script type="text/javascript" src="assets/style/js/bdmap.drawingManager.js"></script> <!--鼠标绘制工具 (这里要屏蔽)-->
    <script type="text/javascript" src="assets/style/js/jquery-1.8.3.min.js"></script><!--Jq库-->
    <script type="text/javascript" src="assets/neatui/js/neatui.min.js"></script><!--前端框架-->
    <script type="text/javascript" src="assets/neatui/js/neatui-dialog.js"></script><!--对话框-->
    <script type="text/javascript" src="assets/neatui/js/neatui-ajax.js"></script><!--自定义ajax-->
    <script type="text/javascript">

        /*+————————————————全局变量————————————————+*/
        var g_xuexiao_bh = ''; // '<%=s_xuexiao_bh%>'; // 学校编号 ajax({})
        var g_xuexiao_mc = ''; // 学校名称
        var g_zhongxin_zb = ''; // 地图中心点坐标


        /*+————————————————FUNCTION————————————————+*/
        /**
         * 自定义工具库类
         */
        var tools = {
            /**
             * 将经纬度坐标数组转化成字符串数组
             * @param {array} ps_coord_arr 经纬度坐标数组. eg. [{lng:"116.387112", lat:"39.920977"}, {lng:"116.387112", lat:"39.920977"}]
             * @returns {array} 返回字符串数组. eg. ["116.387112,39.920977", "116.387112,39.920977"]
             */
            converCoordinateArray2StringArray: function(ps_coord_arr){
                var strArr = []
                for(var i = 0; i < ps_coord_arr.length; i++){
                    strArr.push(ps_coord_arr[i].lng + "," + ps_coord_arr[i].lat);
                }
                return strArr;
            },

            /**
             * 清除多边形覆盖物
             */
            removePolyOverlay: function(){
                // 清除多边形覆盖物
                var map = bdChinaMap.map;
                var allOverlay = map.getOverlays();
                allOverlay.map(function(item){
                    if(item.name === 'duobianxing'){
                        map.removeOverlay(item);
                    }
                })
            },
            
            
            /**
             * 获取多边形坐标数据
             * @returns {array} 返回字符串型坐标数组
             */
            getPolyCoordinateData: function(){
                var self = this;
                // 获取多边形的点坐标
                var arr = [];
                var map = bdChinaMap.map;
                var allOverlay = map.getOverlays();
                allOverlay.map(function(item, index){
                    if(item.name === 'duobianxing'){
                        // console.log('item：', item);
                        arr.push(item.Ao);
                    }
                })
                // console.log('tempArr:', arr)
                // 将经纬度坐标转化成字符串型数组
                var coordArr = [ ];
                for(var i = 0; i < arr.length; i++){
                    coordArr.push(this.converCoordinateArray2StringArray(arr[i]));
                }
                // console.log('coordArr：', coordArr);
                return coordArr;
            }
        }
        

        /**
         * 百度地图类对象
         * 参考：http://mobai.blog.51cto.com/
         */
        var bdChinaMap = {
            status: false,
            map: '', // 地图根节点
            
            center: '118.611836,24.918225', // 中心点坐标. eg.'经度,纬度'
            caption: '泉州市', // 中心点说明文字
            zoom: 11, // 缩放级别(3-19)
            point: '', // 地图中心点信息. eg. new BMap.Point(经度,纬度)

            marker: '', // 点标记覆盖物
            label: '', // 信息窗覆盖物
            overlays: [], // 全部覆盖物

            overlaysCache: [],
            myPoints: [], // 所有坐标点数组
            myPolygon: '',
            myOverlay: [],
            drawingManager: '',
            styleOptions: {
                strokeColor: "red",      // 边线颜色。
                fillColor: "red",        // 填充颜色。当参数为空时，圆形将没有填充效果。
                strokeWeight: 3,        // 边线的宽度，以像素为单位。
                strokeOpacity: 0.8,     // 边线透明度，取值范围0 - 1。
                fillOpacity: 0.3,       // 填充的透明度，取值范围0 - 1。
                strokeStyle: 'solid'    // 边线的样式，solid或dashed。
            },

            /**
             * 实例化
             */
            init: function () {
                if (this.status) {
                    return;
                }
                this.center = this.center == '' ? '118.611836,24.918225' : this.center; // 当中心点坐标为空时,设定一个默认坐标
                this.status = true;
                this.map = new BMap.Map('map');
                this.point = new BMap.Point(this.center.split(',')[0], this.center.split(',')[1]);
                var map = this.map;
                var styleOptions = this.styleOptions;
                map.centerAndZoom(this.point, 16);
                map.enableScrollWheelZoom();
                
                // 添加点标记
                this.addMarker();

                // 实例化鼠标绘制工具
                this.drawingManager = new BMapLib.DrawingManager(map, {
                    isOpen: false, // 是否开启绘制模式
                    enableDrawingTool: true, // 是否显示工具栏
                    drawingToolOptions: { // 可选的输入参数，非必填项
                        anchor: BMAP_ANCHOR_TOP_RIGHT, // 位置
                        offset: new BMap.Size(5, 5), // 偏离值
                        scale: 0.8, // 工具栏缩放比例
                        drawingModes : [  // 工具栏上可以选择出现的绘制模式(可选),将需要显示的DrawingType以数组型形式传入，如[BMAP_DRAWING_MARKER, BMAP_DRAWING_CIRCLE] 将只显示画点和画圆的选项. 
                            // BMAP_DRAWING_MARKER, // 画点(画位置)
                            // BMAP_DRAWING_CIRCLE, // 画圆
                            BMAP_DRAWING_POLYLINE, // 画线
                            BMAP_DRAWING_POLYGON, // 画多边形
                            BMAP_DRAWING_RECTANGLE // 画矩形
                        ]
                    },
                    enableCalculate: false, // 绘制是否进行测距(画线时候)、测面(画圆、多边形、矩形)
                    circleOptions: styleOptions, // 圆的样式
                    polylineOptions: styleOptions, // 线的样式
                    polygonOptions: styleOptions, // 多边形的样式
                    rectangleOptions: styleOptions // 矩形的样式
                })
                // 添加鼠标绘制工具监听事件，用于获取绘制结果
                this.drawingManager.addEventListener('overlaycomplete', bdChinaMap.overlaycomplete);

     
                // 加载多边形testing
                if(this.myPoints.length != 0){
                    // 加载多个已有的多边形
                    for(var i = 0; i < this.myPoints.length; i++){
                        this.myOverlay = this.myPoints[i];
                        if (this.myOverlay) {
                            this.loadMyOverlay();
                        }
                    }
                    // console.log('aaa')
                }else{
                    // 加载一个已有的多边形
                    if (this.myOverlay) this.loadMyOverlay();
                    // console.log('bbb')
                }
                // 鼠标右键点击事件
                map.addEventListener("rightclick", function (e) {
                    // alert(e.point.lng + "," + e.point.lat);
                })
            },

            /**
             * 加载覆盖物
             */
            loadMyOverlay: function () {
                var map = this.map;
                // this.clearAll();
                map.centerAndZoom(this.point, this.zoom); // 设置地图中心点

                // 创建多边形覆盖物
                var ply = new BMap.Polygon(this.myOverlay, this.styleOptions);
                this.myPolygon = ply;
                try { 
                    ply.enableEditing(); 
                    ply.name = 'duobianxing'; // 标记覆盖物类型,方便清除指定覆盖物时用
                } 
                catch (e) { 

                };
                ply.addEventListener("lineupdate", function (e) { // 拖动边线进行编辑时监听事件
                    // console.log('e:', e)
                    bdChinaMap.showLatLon(e.currentTarget.ha);
                })
                // bdChinaMap.showLatLon(myPolygon.getPath()); // 绘制完成时显示覆盖物点信息 testing
                map.addOverlay(ply);
            },

            /**
             * 显示覆盖物点坐标
             */
            showLatLon: function (a) {
                // console.log('a：', a)
                var len = a.length;
                var s = '';
                var arr = [];
                for (var i = 0; i < len - 1; i++) {
                    arr.push([a[i].lng, a[i].lat]);
                    s += '<li>' + a[i].lng + ',' + a[i].lat + '<span class="red" title="删除" onclick="bdChinaMap.delPoint(' + i + ')">X</span></li>';
                }
                this.overlaysCache = arr;
                $("#panelWrap")[0].innerHTML = '<ul>' + s + '</ul>';
            },

    

            /**
             *绘制完成后回调获得覆盖物信息
             */
            overlaycomplete: function (e) {
                e.overlay.name = 'duobianxing'; // 标记覆盖物类型,方便清除指定覆盖物时用
                bdChinaMap.overlays.push(e.overlay);
                if(typeof e.overlay.enableEditing != 'undefined') e.overlay.enableEditing();
                e.overlay.addEventListener("lineupdate", function (e) { // 拖动边线进行编辑时监听事件
                    // console.log('e:', e);
                    bdChinaMap.showLatLon(e.currentTarget.ha);
                });
                if(typeof e.overlay.getPath != 'undefined'){ // 绘制完成时显示覆盖物点信息 testing
                    bdChinaMap.showLatLon(e.overlay.getPath());
                }
            },

            /**
             * 删除覆盖物点坐标
             */
             delPoint: function (i) {
                if (this.overlaysCache.length <= 3) {
                    alert('不能再删除, 请保留3个以上的点.');
                    return;
                }
                this.overlaysCache.splice(i, 1);
                var a = this.overlaysCache;
                var newOverlay = [];
                for (var i in a) {
                    newOverlay.push(new BMap.Point(a[i][0], a[i][1]));
                }
                this.myOverlay = newOverlay;
                this.loadMyOverlay();
            },

            /**
             * 添加点标记
             */
            addMarker: function(){
                var map = this.map;
                // 添加点标记
                var marker = new BMap.Marker(this.point);
                marker.enableDragging();
                marker.name = 'dianbiaoji'; // 标记覆盖物类型,方便清除指定覆盖物时用
                map.addOverlay(marker);
                this.marker = marker;

                // 添加信息窗
                var lbText =  '<div class="bdLabel">' + this.caption + '</div>',
                    lbOptions = {
                        position: this.point, // 指定文本标注所在的地理位置
                        // offset: new BMap.Size(30, -30) // 设置文本偏移量
                        width: 0,     // 宽度(220-730) 0 自动调整
                        maxWidth:500,  // 最大宽度(220-730)
                        height: 0,     // 高度(60-650) 0 自动调整
                        offset: { // 位置偏移
                            width: 10, 
                            height: -50
                        }
                    }
                var label = new BMap.Label(lbText, lbOptions);
                label.setStyle({
                    color: 'blue',
                    borderRadius: '5px',
                    borderColor: '#ccc',
                    padding: '10px',
                    fontSize: '16px',
                    height: '30px',
                    lineHeight: '30px',
                    fontFamily: '微软雅黑'
                })
                label.name = 'xinxichuang'; // 标记覆盖物类型,方便清除指定覆盖物时用
                marker.setLabel(label); // 绑定信息窗到点标记上
                map.addOverlay(label);
                setTimeout(function(){ // 更改信息窗样式
                    $('.bdLabel').parent().addClass('bdMarkerLabel');
                }, 0)
                this.label = label;
                this.dragMarker();

                // 坐标拾取器赋值
                if($('#c-locate').length != 0) $('#c-locate').val(this.center);
            },


            /**
             * 拖动点标记事件
             */
            dragMarker: function(){
                // 拖拽点标记时会触发此事件
                var marker = this.marker;
                 marker.addEventListener('dragend', function(e){
                    var x = e.point.lng,
                        y = e.point.lat;
                    // console.log('x:',x, '\ny:',y)
                    var ele = $('#c-locate');
                    if(ele.length == 0) return;
                    ele.val( x + ',' + y);
                })
            },
            
            /**
             * 清除所有覆盖物
             */
            clearAll: function () {
                var r = confirm('确认清除所有覆盖物？');
                if(r !== true) return;
                var map = this.map;
                var overlays = this.overlays;
                for (var i = 0; i < overlays.length; i++) {
                    map.removeOverlay(overlays[i]);
                }
                this.overlays.length = 0
                map.removeOverlay(this.myPolygon);
                this.myPolygon = '';
            },

            
            /**
             * 清除多边形覆盖物
             */
            removeMarkerOverlay: function(){
                var map = this.map;
                var allOverlay = map.getOverlays();
                allOverlay.map(function(item){
                    if(item.name === 'dianbiaoji'){
                        map.removeOverlay(item);
                    }
                })
            },
          

            /**
             *取覆盖物的经纬度
             */
            getOverLay: function () {
                // var box = this.myPolygon ? this.myPolygon : this.overlays[this.overlays.length - 1];
                var box = this.overlays.length == 0 ? this.myPolygon : this.overlays[this.overlays.length - 1];
                var coordinateArr = typeof box == 'undefined' ? [] : typeof box.Ao == 'undefined' ? [] : box.Ao;
                // console.log('box:', box)
                console.log('最后一个覆盖物信息：', coordinateArr);
            },

            /**
             * 获取覆盖物个数
             */
            getCount: function () {
                var n = 0;
                if (this.myPolygon) {
                    n++;
                };
                if (this.overlays) {
                    n = n + this.overlays.length;
                };
                // console.log('当前覆盖物个数：', n);
            }
        };


        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        $(function(){

            //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
            //                                                   创建学校坐标、学区范围
            //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
            //——————————————————————————————————————————
            //======后台返回学校坐标数据
            var schoolJson = {
                "return":"ok", "data":[
                    {"xuexiao_bh":"X1001", "xuexiao_mc":"泉州五中", "xuexiao_ms":"泉州五中是泉州市最好的学校", "zuobiao":"118.611836,24.918225"}
                ]
            }
            /*
            //START AJAX
            var schoolJson = {}
            var isHoldOn = true;
            ajax({
                heading: "获取学校坐标",
                debug: false,
                async: false, // 取数方式. true 异步, false 同步(默认)
                type: "GET",
                dataType: "html",
                cache: false,
                url: "../fwh_pub/jk_xuexiao_xq.ashx",
                data: {
                    "action": "wh_xuexiao_query_one",
                    "menu_bh": "<%=s_menu_bh%>",
                    "user": "<%=s_user%>",
                    "sjk": "<%=s_sjk%>",
                    "xuexiao_bh": g_xuexiao_bh
                },
                success: function(res){
                    if(toolTip.mistakeTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                    // if(res == '') return;
                    schoolJson = JSON.parse(res);
                },
                error: function(res){
                    if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                },
                beforeSend: function(XMLHttpRequest){ },
                complete: function(XMLHttpRequest, textStatus){ }
            })
            if(!isHoldOn){
                return;
            }
            //END AJAX
            */

            // 全局赋值
            var firstRowData = schoolJson.data[0];
            // g_xuexiao_bh = firstRowData["xuexiao_bh"];
            g_xuexiao_mc = firstRowData["xuexiao_mc"];
            g_zhongxin_zb = firstRowData["zuobiao"];



            //——————————————————————————————————————————
            //======后台返回学区坐标数据
            var coordinateJson = { // 泉州市点坐标数组
                "return":"ok",
                "data":[
                    { "weizhi":"1001", "data":[
                        {"zuobiao":"118.599547, 24.9246154"},
                        {"zuobiao":"118.607812, 24.9197654"},
                        {"zuobiao":"118.594948, 24.91308"}
                    ]},
                    { "weizhi":"1002", "data":[
                        {"zuobiao":"118.602206, 24.914588"},
                        {"zuobiao":"118.612986, 24.912294"},
                        {"zuobiao":"118.606302, 24.906198"},
                        {"zuobiao":"118.601991, 24.904035"},
                        {"zuobiao":"118.598829, 24.908361"},
                        {"zuobiao":"118.598829, 24.908361"}
                    ]}
                ]
            }
            /*
            //START AJAX
            var coordinateJson = {}
            var isHoldOn = true;
            ajax({
                heading: "获取学区坐标",
                debug: false,
                async: false, // 取数方式. true 异步, false 同步(默认)
                type: "GET",
                dataType: "html",
                cache: false,
                url: "../fwh_pub/jk_xuexiao_xq.ashx",
                data: {
                    "action": "wh_xuexiao_xq_zuobiao_query_one",
                    "menu_bh": "<%=s_menu_bh%>",
                    "user": "<%=s_user%>",
                    "sjk": "<%=s_sjk%>",
                    "xuexiao_bh": g_xuexiao_bh
                },
                success: function(res){
                    if(toolTip.mistakeTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                    // if(res == '') return;
                    coordinateJson = JSON.parse(res);
                },
                error: function(res){
                    if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                },
                beforeSend: function(XMLHttpRequest){ },
                complete: function(XMLHttpRequest, textStatus){ }
            })
            if(!isHoldOn){
                return;
            }
            //END AJAX
            */


            // 将坐标数据转化经纬度坐标数组
            /*
            * 转化后的格式示例eg：
                var coordinateArray = [
                    [
                        new BMap.Point(116.256515, 39.995242),
                        new BMap.Point(116.502579, 39.951893),
                        new BMap.Point(116.256515, 39.866882)
                    ],
                    [
                        new BMap.Point(116.264158, 40.31587),
                        new BMap.Point(116.280256, 40.188118),
                        new BMap.Point(116.417086, 40.189882)
                    ]
                ]
            */
            var coordinateArray = [ ];
            if(typeof coordinateJson.data != 'undefined'){
                for(var i1 = 0; i1 < coordinateJson.data.length; i1++){
                    var item1 = coordinateJson.data[i1];
                    var arr = [ ];
                    if(typeof item1.data != 'undefined'){
                        for(var i2 = 0; i2 < item1.data.length; i2++){
                            var item2 = item1.data[i2];
                            var zb = item2.zuobiao;
                            var tmpArr = item2.zuobiao.split(','),
                                lng= tmpArr[0], lat = tmpArr[1];
                            arr.push(new BMap.Point(lng, lat));
                        }
                    }
                    coordinateArray.push(arr);
                }
            }


            //——————————————————————————————————————————
            //=====地图初始化
            // console.log('overlayArrray:', coordinateArray)
            bdChinaMap.center = g_zhongxin_zb; // '118.611836,24.918225'; // 中心点坐标
            bdChinaMap.caption = g_xuexiao_mc; // '泉州市'; // 中心点说明文字
            bdChinaMap.zoom = 15; // 缩放级别
            // // 1、加载一个已有的多边形
            // bdChinaMap.myOverlay = [
            //     new BMap.Point(116.256515, 39.995242),
            //     new BMap.Point(116.502579, 39.951893),
            //     new BMap.Point(116.256515, 39.866882)
            // ];
            // bdChinaMap.init();
            // 2、加载多个已有的多边形
            bdChinaMap.myPoints = coordinateArray;     
            bdChinaMap.init();
            //设置地图区域高度
            $('.bdmap__map').css({
                height: $('.bdmap').height() - parseFloat($('.bdmap').css('paddingTop')) * 2 - $('.bdmap__editor').outerHeight(true)
            })





            //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
            //                                                   系列点击事件
            //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
            //——————————————————————————————————————————
            // =====显示结果面板动作、编辑多边形
            var isPanelShow = false;
            $("#showPanelBtn").on('click', function(){
                if (isPanelShow == false) {
                    isPanelShow = true;
                    $("#showPanelBtn")[0].style.right = "230px";
                    $("#panelWrap")[0].style.width = "230px";
                    $("#map")[0].style.marginRight = "230px";
                    $("#showPanelBtn")[0].innerHTML = "编辑多边形<br/>>";
                } else {
                    isPanelShow = false;
                    $("#showPanelBtn")[0].style.right = "0px";
                    $("#panelWrap")[0].style.width = "0px";
                    $("#map")[0].style.marginRight = "0px";
                    $("#showPanelBtn")[0].innerHTML = "编辑多边形<br/><";
                }
            });





            //——————————————————————————————————————————
            // =====复制按钮、复制当前坐标
            $('#btn-pick-copy').on('click', function(){
                var $text = $(this).siblings('#c-locate')
                var value = $text.val();
                $text[0].select();
                document.execCommand("Copy"); // 执行浏览器复制命令
                var tips = '已复制好，可贴粘！';
                // alert(tips);
                neuiDialog.notice({
                    message: tips,
                    theme: 'black',
                    maskOpacity: 1
                })
            });





            //——————————————————————————————————————————
            // =====保存学校坐标按钮
            $('#btn-pick-save').on('click', function(){
                var ls_zuobiao = $('#c-locate').val();
                var arr = [ ls_zuobiao ]
                // console.log('数组：', arr);

                // 开始执行
                var flag = '', msg = '保存成功';
                neui.showAnimate();
                setTimeout(function(){
                    //后台返回
                    /*
                    //START AJAX
                    var isHoldOn = true;
                    ajax({
                        heading: "保存学校坐标",
                        debug: false,
                        async: false, // 取数方式. true 异步, false 同步(默认)
                        type: "GET",
                        dataType: "html",
                        cache: false,
                        url: "../fwh_pub/jk_xuexiao_xq.ashx",
                        data: {
                            "action": "wh_xuexiao_zuobiao_ins",
                            "menu_bh": "<%=s_menu_bh%>",
                            "user": "<%=s_user%>",
                            "sjk": "<%=s_sjk%>",
                            "xuexiao_bh": g_xuexiao_bh,
                            "zuobiao": ls_zuobiao
                        },
                        success: function(res){
                            if(toolTip.emptyTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                            var json = JSON.parse(res);
                            flag = json.return == 'ok' ? 1 : 0;
                            if(!flag) msg = json.data;
                        },
                        error: function(res){
                            if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                        },
                        beforeSend: function(XMLHttpRequest){ },
                        complete: function(XMLHttpRequest, textStatus){ }
                    })
                    if(!isHoldOn){
                        neui.destroyAnimate();
                        return;
                    }
                    //END AJAX
                    */
                    flag = parseInt(1); //1 成功, 0 失败
                    if(!flag) msg = '保存失败';

                    neuiDialog.alert({
                        caption: '提示',
                        message: msg,
                        buttons: ['确定']
                    })
                    neui.destroyAnimate();
                }, 100)
            });




            
            //——————————————————————————————————————————
            // =====保存学区范围按钮
            $('#btn-poly-save').on('click', function(){
                // 获取学区范围坐标数据
                var coordArr = tools.getPolyCoordinateData();
                // console.log('保存时coordArr：', coordArr);
                // 开始执行
                var flag = '', msg = '保存成功';
                neui.showAnimate();
                setTimeout(function(){
                    for(var i = 0; i < coordArr.length; i++){
                        var row = coordArr[i];
                        var xuhao = "100" + (i + 1); // eg.1001, 1002, 1003, ...
                            data = row;
                        var saveArr1 = [ xuhao, data ]
                        // console.log('外部行循环数组:', saveArr1);

                        var isGoOn = true; // 是否继续循环, true 是, false 否
                        for(var k = 0; k < data.length; k++){
                            var ls_weizhi = xuhao,
                                ls_zuobiao = data[k],
                                ls_counts = i == 0 && k == 0 ? 0 : ''; // 第一行传0，其它传空
                            var saveArr2 = [ ls_weizhi, ls_zuobiao, ls_counts ]
                            // console.log('内部行循环数组：', saveArr2);
                            // 后台返回
                            /*
                            // START AJAX
                            var isHoldOn = true;
                            ajax({
                                heading: "保存学区坐标",
                                debug: false,
                                async: false, // 取数方式. true 异步, false 同步(默认)
                                type: "GET",
                                dataType: "html",
                                cache: false,
                                url: "../fwh_pub/jk_xuexiao_xq.ashx",
                                data: {
                                    "action": "wh_xuexiao_xq_zuobiao_ins",
                                    "menu_bh": "<%=s_menu_bh%>",
                                    "user": "<%=s_user%>",
                                    "sjk": "<%=s_sjk%>",
                                    "xuexiao_bh": g_xuexiao_bh,
                                    "weizhi": ls_weizhi,
                                    "zuobiao": ls_zuobiao,
                                    "counts": ls_counts
                                },
                                success: function(res){
                                    if(toolTip.emptyTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                                    var json = JSON.parse(res);
                                    flag = json.return == 'ok' ? 1 : 0;
                                    if(!flag) msg = json.data;
                                },
                                error: function(res){
                                    if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                                },
                                beforeSend: function(XMLHttpRequest){ },
                                complete: function(XMLHttpRequest, textStatus){ }
                            })
                            if(!isHoldOn){
                                neui.destroyAnimate();
                                return;
                            }
                            // END AJAX
                            */
                            flag = parseInt(1); // 1 成功, 0 失败
                            if(!flag) msg = '保存失败';


                            if(!flag){
                                isGoOn = false;
                                break;
                            }
                        } // END 内层FOR

                        if(!isGoOn) break;
                    } // END 外层FOR

                    neuiDialog.alert({
                        caption: '提示',
                        message: msg,
                        buttons: ['确定']
                    })
                    neui.destroyAnimate();
                }, 100)
            });





            //——————————————————————————————————————————
            //=====删除学区范围按钮
            $('#btn-poly-del').on('click', function(){
                neuiDialog.alert({
                    animate: true,
                    caption: '提示',
                    message: '确认删除学区范围？',
                    buttons: ['确定', '取消'],
                    callBack: function(ret){
                        if(ret == 1){
                            // 获取学区范围坐标数据
                            var coordArr = tools.getPolyCoordinateData();
                            // console.log('删除时coordArr：', coordArr);
                            // 开始执行
                            var flag = '', msg = '删除成功';
                            neui.showAnimate();
                            setTimeout(function(){
                                //后台返回
                                /*
                                //START AJAX
                                var isHoldOn = true;
                                ajax({
                                    heading: "删除学区坐标",
                                    debug: false,
                                    async: false, // 取数方式. true 异步, false 同步(默认)
                                    type: "GET",
                                    dataType: "html",
                                    cache: false,
                                    url: "../fwh_pub/jk_xuexiao_xq.ashx",
                                    data: {
                                        "action": "wh_xuexiao_xq_zuobiao_del",
                                        "menu_bh": "<%=s_menu_bh%>",
                                        "user": "<%=s_user%>",
                                        "sjk": "<%=s_sjk%>",
                                        "xuexiao_bh": g_xuexiao_bh
                                    },
                                    success: function(res){
                                        if(toolTip.emptyTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                                        var json = JSON.parse(res);
                                        flag = json.return == 'ok' ? 1 : 0;
                                        if(!flag) msg = json.data;
                                    },
                                    error: function(res){
                                        if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                                    },
                                    beforeSend: function(XMLHttpRequest){ },
                                    complete: function(XMLHttpRequest, textStatus){ }
                                })
                                if(!isHoldOn){
                                    neui.destroyAnimate();
                                    return;
                                }
                                //END AJAX
                                */
                                flag = parseInt(1); //1 成功, 0 失败
                                if(!flag) msg = '删除失败';

                                neuiDialog.alert({
                                    caption: '提示',
                                    message: msg,
                                    buttons: ['确定'],
                                    callBack: function(){
                                        if(flag){ //成功
                                            tools.removePolyOverlay(); // 清除多边形覆盖物
                                        }
                                    }
                                })

                                neui.destroyAnimate();
                            }, 100)
                        }
                    }
                })
            });




        }); // $(function(){})
    </script>
</body>
</html>