<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="网站名称">
    <meta name="applicable-device" content="pc,mobile">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <title>neuiProgressBar 进度条控件模拟后端请求</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link type="text/css" rel="stylesheet" href="assets/neatui/css/neatui.min.css"><!--前端框架-->
    <link type="text/css" rel="stylesheet" href="assets/neatui/css/neatui-dialog.css"><!--对话框-->
    <link type="text/css" rel="stylesheet" href="assets/neatui/css/neatui-progressBar.css">
</head>

<body>

    <style>
        html, body{ padding: 25px; background-color: #f4f4f4; }
        .wrap{ width: 70%; margin: 0 auto; padding: 50px; background-color: #fff;  border: 3px solid blue; border-radius: 4px; }
        h1{ margin-bottom: 35px; font-size: 24rpx; text-align: center; }
    </style>

    <div class="wrap">
        <div class="controls">
            <h1>进度条演示</h1>
            <div class="new_div_wrap"></div>
        </div>
    </div><!--/.wrap-->


    <!--================================================================================-->
    <!--                            JAVASCRIPT                                          -->
    <!--================================================================================-->
    <script src="assets/libs/jquery-1.8.3.min.js"></script><!--jQ库-->
    <script src="assets/lib/mock/mock-min.js"></script><!--MOCK库-->
    <script src="assets/neatui/js/neatui.min.js"></script><!--前端框架-->
    <script src="assets/neatui/js/neatui-dialog.js"></script><!--对话框-->
    <script src="assets/neatui/js/neatui-progressBar.js"></script><!--进度条控件-->
    <script src="assets/neatui/js/neatui-ajax.js"></script><!--自定义封装AJAX-->
    <script>
        /*+————————————————全局变量————————————————+*/

        /*+————————————————FUNCTION————————————————+*/
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        $(function () {
            //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
            //+                                                          初始化                                                 
            //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
            //——————————————————————————————————————————
            // 进度条配置项
            var options = {
               // 主题样式
                theme: 'green',
                // 大小与位置
                position: 'fixed',
                zIndex: 99,
                width: 300,
                height: 100,
                // 常用属性
                duration: 100,
            }
            neuiProgressBar(options); // 创建进度条并初始化


        





            //——————————————————————————————————————————————————————————
            //    以下为 模拟实际接口请求中使用进度 的测试代码，请忽略
            //——————————————————————————————————————————————————————————
            //——————————————————————————————————————————
            // todo: Mock 获取用户信息
            // 设置延时时长，模拟后端处理或返回数据的时间。
            Mock.setup({
                timeout: "100-2000", // 延时m到n毫秒返回
            });
            // 拦截ajax请求并返回数据
            Mock.mock("../../jk/pub_user_jk/get_user_info.ashx?param=1", "post", function(v){
                // console.log('后台传过来的参数：', v);
                // 关于 v.body 的类型为字符串或对象，分以下情况：
                // axios 请求方式：post时它是对象, get时它是字符串
                // ajax 请求方式：无论是get或post，它都是字符串
                return Mock.mock({
                    "return": "ok",
                    "data": "保存成功",
                    //
                    // "return": "error",
                    // "data": "保存失败",
                })
            });



            var start = 0;
            var max = 500;
            var flag = '', msg = '保存成功';
            for(var i = 0; i <= max; i++){

                // 后台返回
                // START AJAX
                var isHoldOn = true;
                ajax({
                    heading: "保存用户数据",
                    debug: false,
                    clean: false, // 项目正式上线时，只要将 clean 设为 true，控件就会自动去掉 url 请求地址中的某几个字符串，这几个字符串见参数 matches: ['param']
                    matches: ['param'], // 
                    async: false, // 取数方式. true 异步, false 同步(默认)
                    type: "POST", // 注意：使用 Mock 模拟数据时，若 ajax 有data 参数，则type必须为post而不能为get，否则拦截失效
                    dataType: "html",
                    cache: false,
                    url: "../../jk/pub_user_jk/get_user_info.ashx?param=1", // 这里的 URL 要和 Mock.mock(urk, type, function(v)) 中的 url 保持一致。关注：param=1，之所以用这种形式，是因为同一个页面可能会有好几个接口，但URL请求地址是一样的，为了让不同接口分别能获取到数据就用 '?param=1', '?param=2', ?param=3'... 这种格式
                    data: {
                        "action": "",
                        "user": "<%=s_user%>",
                        "sjk": "<%=s_sjk%>"
                    },
                    success: function(res){
                        if(toolTip.mistakeTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                        var json = JSON.parse(res);
                        flag = json.return == 'ok' ? 1 : 0;
                        if(!flag) msg = json.data;
                    },
                    error: function(errs){
                        if(toolTip.wrongTips(errs, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                    },
                    beforeSend: function(xhr){ },
                    complete: function(xhr, status){ }
                })
                if(!isHoldOn){
                    neui.destroyAnimate();
                    return;
                }
                // END AJAX

                if(!flag){
                    break;
                }
                else{
                    neuiProgressBar.updateProgress(i);
                }
            }
            
            // console.log('flag：', flag);
            // console.log('start：', start);
            // if(flag == 0){
            //     console.log('执行失败了');
            // }


            // setTimeout(() => {
            //     neuiProgressBar.destroy(10);
            //     neuiDialog.alert({
            //         message: msg,
            //         buttons: ['确定'],
            //         callback(){
            //             if(flag){
            //                 // neuiProgressBar.destroy(1000);
            //             }
            //         }
            //     });
            // }, 2000);

            console.log('是否完成：', neuiProgressBar.finish());
           


    


        }); //$(function(){});
    </script>


</body>

</html>