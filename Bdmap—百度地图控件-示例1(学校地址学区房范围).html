<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="网站名称">
    <meta name="applicable-device" content="pc,mobile">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <title>BaiduMap | 百度地图实例化控件v2.0.0(测试版) (学校地址坐标、学区房范围)</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link type="text/css" rel="stylesheet" href="assets/neatui/css/neatui.min.css"><!--前端框架-->
    <link type="text/css" rel="stylesheet" href="assets/neatui/css/neatui-dialog.css"><!--对话框-->
    <link type="text/css" rel="stylesheet" href="assets/neatui/css/neatui-bdmap.css?v=20210621-2"><!--百度地图控件-->
</head>

<body>
    <div class="bdmap" id="allmap"><!--edit 20210621-1-->
        <div class="bdmap__editor">
            <div class="bdmap__picker">
                当前学校坐标 <input type="text" id="c-locate">
                <button type="button" data-type="copy" id="btn-pick-copy">复制</button>
                <button type="button" data-type="save" id="btn-pick-save">保存学校坐标</button>
                <label> (拖动点标记可更改坐标) </label>
            </div>
            <div class="bdmap__draw">
                <button type="button" data-type="del" id="btn-poly-del">删除学区范围</button>
                <button type="button" data-type="save" id="btn-poly-save">保存学区范围</button>
            </div><!--/.bdmap__draw-->
        </div><!--/.bdmap__editor-->
        <div class="bdmap__map">
            <div id="map"></div>
            <div class="bdmap__mouse">
                <div class="bdmap__mouse-title">绘制学区范围步骤</div>
                <div class="bdmap__mouse-step">
                    <p class="bold">一、绘制步骤(正方形)：</p>
                    <p>1、选择绘制工具；</p>
                    <p>2、按住鼠标左键，在地图任意位置上拖动<br>
                        放开鼠标左键，即可完成绘制
                    </p>
                    <p>3、拖动图形上的白色小正方框，可更改形状。</p>
                    <p class="bold">二、绘制步骤(线条、多边形等)：</p>
                    <p>1、选择绘制工具；</p>
                    <p>2、点击地图任意位置(作为起始点)；</p>
                    <p>3、移动鼠标，再次点击地图任意位置<br>
                        (就会出现线条或形状)；
                    </p>
                    <p>4、重复上一步；</p>
                    <p>5、双击鼠标，完成绘制；</p>
                    <p>6、拖动图形上的白色小正方框，可更改形状。</p>

                </div><!--/.bdmap__mouse-step-->
            </div><!--/.bdmap__mouse-->
            <div id="showPanelBtn">编辑多边形&lt;</div>
            <div id="panelWrap">
                <div id="showOverlayInfo">此处用于展示覆盖物信息</div>
                <div id="panel"></div>
            </div>
        </div><!--/.bdmap__map-->
    </div><!--/.allmap-->
    
    <div id="result">
        <dl>
            <dt>绘制工具功能</dt>
            <dd>
                <ul>
                    <li><label><input type="radio" name="openClose1" onclick="bdChinaMap.drawingManager.open()" />打开</label>
                        <label><input type="radio" name="openClose1" onclick="bdChinaMap.drawingManager.close()" checked="checked" />关闭</label></li>
                </ul>
            </dd>

            <dt>是否进行线或面积的计算(单位米)</dt>
            <dd>
                <ul>
                    <li>
                        <label><input type="radio" name="openClose" onclick="bdChinaMap.drawingManager.enableCalculate()">打开</label> 
                        <label><input type="radio" name="openClose" onclick="bdChinaMap.drawingManager.disableCalculate()" checked="checked">关闭</label>
                    </li>
                </ul>
            </dd>

            <dt>绘制功能</dt>
            <dd>
                <ul>
                    <li>
                        <label><input type="radio" name="drawmode"  onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_MARKER)" checked="checked">画点</label>
                        <input type="checkbox" id="isInfowindow"> 是否带信息窗口
                    </li>
                    <li>
                        <label><input type="radio" name="drawmode" onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_CIRCLE)">画圆</label>
                    </li>
                    <li>
                        <label><input type="radio" name="drawmode" onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_POLYLINE)">画线</label>
                    </li>
                    <li>
                        <label><input type="radio" name="drawmode" onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_POLYGON)">画多边形</label>
                    </li>
                    <li>
                        <label><input type="radio" name="drawmode" onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_RECTANGLE)">画矩形</label>
                    </li>
                </ul>
            </dd>

            <dt>覆盖物操作</dt>
            <dd>
                <ul>
                    <li>
                        <input type="button" value="获取绘制的覆盖物个数" onclick="bdChinaMap.getCount()" />
                        <input type="button" value="清除所有覆盖物" onclick="bdChinaMap.clearAll()" />
                        <input type="button" value="获取最后一个覆盖物信息" onclick="bdChinaMap.getOverLay()" />
                    </li>
                </ul>
            </dd>
        </dl>
    </div>
    

    <!--================================================================================-->
    <!--                            JAVASCRIPT                                          -->
    <!--================================================================================-->
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=2COzFaICuIyVj7V3VetKfmdRVnX8BhVr"></script><!--百度地图api文件 (这里要屏蔽)-->
    <script type="text/javascript" src="assets/style/js/bdmap.drawingManager.js"></script> <!--鼠标绘制工具 (这里要屏蔽)-->
    <script type="text/javascript" src="assets/style/js/jquery-1.8.3.min.js"></script><!--Jq库-->
    <script type="text/javascript" src="assets/neatui/js/neatui.min.js"></script><!--前端框架-->
    <script type="text/javascript" src="assets/neatui/js/neatui-dialog.js"></script><!--对话框-->
    <script type="text/javascript" src="assets/neatui/js/neatui-ajax.js"></script><!--自定义ajax-->
    <script type="text/javascript">

        /*+————————————————全局变量————————————————+*/
        var g_xuexiao_bh = ''; // '<%=s_xuexiao_bh%>'; // 学校编号 ajax({})
        var g_xuexiao_mc = ''; // 学校名称
        var g_zhongxin_zb = ''; // 地图中心点坐标
        var g_ditu_suofang = ''; // 地图缩放级别 add 20210622-1


        /*+————————————————FUNCTION————————————————+*/
        /**
         * 自定义工具库类 edit 20210622-1
         */
        var tools = {
            /**
             * 将经纬度坐标数组转化成字符串数组
             * @param {array} ps_coord_arr 经纬度坐标数组. eg. [{lng:"116.387112", lat:"39.920977"}, {lng:"116.387112", lat:"39.920977"}]
             * @returns {array} 返回字符串数组. eg. ["116.387112,39.920977", "116.387112,39.920977"]
             */
            converCoordinateArray2StringArray: function(ps_coord_arr){
                var strArr = []
                for(var i = 0; i < ps_coord_arr.length; i++){
                    strArr.push(ps_coord_arr[i].lng + "," + ps_coord_arr[i].lat);
                }
                return strArr;
            },

            /**
             * 清除多边形覆盖物
             */
            removePolyOverlay: function(){
                // 清除多边形覆盖物
                var map = bdChinaMap.map;
                var allOverlay = map.getOverlays();
                allOverlay.map(function(item){
                    if(item.name === 'duobianxing'){
                        map.removeOverlay(item);
                    }
                })
            },
            
            
            /**
             * 获取多边形坐标数据
             * @returns {array} 返回字符串型坐标数组
             */
            getPolyCoordinateData: function(){
                var self = this;
                // 获取多边形的点坐标
                var arr = [];
                var map = bdChinaMap.map;
                var allOverlay = map.getOverlays();
                allOverlay.map(function(item, index){
                    if(item.name === 'duobianxing'){
                        // console.log('item：', item);
                        arr.push(item.Ao);
                    }
                })
                // console.log('tempArr:', arr)
                // 将经纬度坐标转化成字符串型数组
                var coordArr = [ ];
                for(var i = 0; i < arr.length; i++){
                    coordArr.push(this.converCoordinateArray2StringArray(arr[i]));
                }
                // console.log('coordArr：', coordArr);
                return coordArr;
            },

            /**
             * 获取地图当前缩放级别
             * @returns {number} 返回缩放级别
             */
            getZoom: function(){
                var map = bdChinaMap.map;
                return map.getZoom();
            }
        }
        

        /**
         * 百度地图类对象 edit 20210712-1
         * 参考：http://mobai.blog.51cto.com/
         */
        var bdChinaMap = {
            status: false,
            map: '', // 地图根节点
            
            center: '118.611836,24.918225', // 中心点坐标. eg.'经度,纬度'
            caption: '泉州市', // 中心点说明文字
            zoom: 11, // 缩放级别(3-19)
            point: '', // 地图中心点信息. eg. new BMap.Point(经度,纬度)
            clickCreateNewCenter: false, // 是否启用点击地图时在点击位置新建中心点坐标(可选), 默认false

            marker: '', // 点标记覆盖物
            label: '', // 信息窗覆盖物
            overlays: [], // 全部覆盖物
            
            default: { // 地图默认配置项,即MapOptions及其它参数(可选)
                enableMapClick: true // 是否启用底图景点可点功能(可选), 默认启用
            },
            image: { // 自定义点标记图标及其它属性(可选)
                enable: false, // 是否启用(可选)，默认false
                path: 'assets/neatui/img/', // 图片路径(可选)
                icon: 'bmap_locate_blue.png', // 图片名称(可选)
                size: 50 // 图片大小(可选)
            },
            infos: { // 自定义信息窗口(可选)
                enable: false, // 是否启用(可选), 默认false
                title : '' , // 标题(可选)。默认为中心点说明文字，支持HTML内容
                message: '', // 短信内容(可选)(这个貌似没用)。完整的短信内容包括：自定义部分+位置链接，不设置时，显示默认短信内容。短信内容最长为140个字
                content: '', // 内容或描述，比如点标记的地址(可选)。默认空，支持HTML内容
                width: 0, // 宽。单位像素，取值范围：0, 220 - 730, 其中0表示自动调整宽
                height: 0, // 高。单位像素，取值范围：0, 60 - 650，其中0表示自动调整高
                method: 'mouseover' // 打开方式(可选). mouseover 鼠标经过点标记时(默认)，click 鼠标点击点标记时
            }, 
            
            overlaysCache: [],
            myPoints: [], // 所有坐标点数组
            myPolygon: '',
            myOverlay: [],
            drawManager: '',
            drawMode: '', // 当前绘制模式(可选), 默认空. 值：空 无任何绘制操作, hander 拖动地图(鼠标为一只手), marker 画点, circle 画圆, polyline 画线,  polygon 画多边形, rectangle 画矩形。
            clickTimes: 0, // 记录地图被点击的次数(可选), 默认0

            styleOptions: {
                strokeColor: 'red', // 边线颜色。
                fillColor: 'red', // 填充颜色。当参数为空时，圆形将没有填充效果。
                strokeWeight: 3, // 边线的宽度，以像素为单位。
                strokeOpacity: 0.8, // 边线透明度，取值范围0 - 1。
                fillOpacity: 0.3,  // 填充的透明度，取值范围0 - 1。
                strokeStyle: 'solid' // 边线的样式，solid或dashed。
            },

            /**
             * 实例化
             */
            init: function () {
                var _this = this;
                if (this.status) {
                    return;
                }
                this.center = this.center == '' ? '118.611836,24.918225' : this.center; // 当中心点坐标为空时,设定一个默认坐标
                this.status = true;
                var options = {
                    enableMapClick: this.default.enableMapClick
                }
                this.map = new BMap.Map('map', options);
                this.point = new BMap.Point(this.center.split(',')[0], this.center.split(',')[1]);
                var map = this.map;
                var styleOptions = this.styleOptions;
                map.centerAndZoom(this.point, 16);
                map.enableScrollWheelZoom();
                
                // 添加点标记
                this.addMarker();
                // 添加信息窗口
                this.addInfoWindow();

                // 实例化鼠标绘制工具
                this.drawManager = new BMapLib.DrawingManager(map, {
                    isOpen: false, // 是否开启绘制模式
                    enableDrawingTool: true, // 是否显示工具栏
                    drawingToolOptions: { // 可选的输入参数，非必填项
                        anchor: BMAP_ANCHOR_TOP_RIGHT, // 位置
                        offset: new BMap.Size(5, 5), // 偏离值
                        scale: 0.8, // 工具栏缩放比例
                        drawingModes : [  // 工具栏上可以选择出现的绘制模式(可选),将需要显示的DrawingType以数组型形式传入，如[BMAP_DRAWING_MARKER, BMAP_DRAWING_CIRCLE] 将只显示画点和画圆的选项.
                            // BMAP_DRAWING_MARKER, // 画点(画位置)
                            // BMAP_DRAWING_CIRCLE, // 画圆
                            BMAP_DRAWING_POLYLINE, // 画线
                            BMAP_DRAWING_POLYGON, // 画多边形
                            BMAP_DRAWING_RECTANGLE // 画矩形
                        ]
                    },
                    enableCalculate: false, // 绘制是否进行测距(画线时候)、测面(画圆、多边形、矩形)
                    circleOptions: styleOptions, // 圆的样式
                    polylineOptions: styleOptions, // 线的样式
                    polygonOptions: styleOptions, // 多边形的样式
                    rectangleOptions: styleOptions // 矩形的样式
                })
                // 添加绘图切换事件
                this.drawCursorHand();

                // 添加鼠标绘制工具监听事件，用于获取绘制结果
                // 绘制点完成后，派发的事件接口
                // this.drawManager.addEventListener('markercomplete', function(e, overlay){ })
                // 绘制圆完成后，派发的事件接口
                // this.drawManager.addEventListener('circlecomplete', function(e, overlay){ })
                // 绘制线完成后，派发的事件接口
                // this.drawManager.addEventListener('polylinecomplete', function(e, overlay){ })
                // 绘制多边形完成后，派发的事件接口
                // this.drawManager.addEventListener('polygoncomplete', function(e, overlay){ })
                // 绘制矩形完成后，派发的事件接口
                // this.drawManager.addEventListener('rectanglecomplete', function(e, overlay){})
                // 鼠标绘制完成后，派发总事件的接口
                this.drawManager.addEventListener('overlaycomplete', function(e){
                    // 绘制完成后回调获得覆盖物信息
                    e.overlay.name = 'duobianxing'; // 标记覆盖物类型,方便清除指定覆盖物时用
                    _this.overlays.push(e.overlay);
                    if(typeof e.overlay.enableEditing != 'undefined') e.overlay.enableEditing();
                    e.overlay.addEventListener("lineupdate", function (event) { // 拖动边线进行编辑时监听事件
                        // console.log('event:', event);
                        _this.drawMode = e.drawingMode; //全局赋值
                        _this.showLatLon(event.currentTarget.ha);
                    })
                    e.overlay.addEventListener("mouseout", function(e){ // 鼠标离开时的监听事件
                        // console.log('鼠标离开了e：', e)
                        _this.drawMode = 'hander'; // 全局赋值
                    })
                    if(typeof e.overlay.getPath != 'undefined'){ // 绘制完成时显示覆盖物点信息
                        _this.showLatLon(e.overlay.getPath());
                    }
                    // 全局赋值 (画点、线完成之后它会自动切换到鼠标为一只手)
                    _this.drawMode = (e.drawingMode == 'polyline' || e.drawingMode == 'polygon') ? 'hander' : e.drawingMode; // 全局赋值
                })


                // 加载多边形
                if(this.myPoints.length != 0){ // 加载多个已有的多边形
                    for(var i = 0; i < this.myPoints.length; i++){
                        this.myOverlay = this.myPoints[i];
                        if (this.myOverlay) {
                            this.loadMyOverlay();
                        }
                    }
                }else{  // 加载一个已有的多边形
                    if (this.myOverlay) this.loadMyOverlay();
                }
                // 鼠标右键点击事件
                map.addEventListener("rightclick", function (e) {
                    // alert(e.point.lng + "," + e.point.lat);
                })
                // 鼠标左键点击事件
                map.addEventListener('click', function(e){
                    // console.log('点我了e：', e);
                    _this.clickTimes++; // 全局赋值
                    if(_this.clickCreateNewCenter){ // 点击地图时把中心点坐标移到点击位置
                        // 当前有覆盖物时，则不执行点击事件(即在覆盖物上点击时，只执行覆盖物的click事件，但不执行map的click事件)
                        if(e.overlay) return;
                        // 当前处于绘图模式时，则不执行点击事件
                        // console.log('mode:', _this.drawMode);
                        if(_this.drawMode != '' && _this.drawMode != 'hander') return;
                        var lng = e.point.lng,  lat = e.point.lat;
                        _this.removeMarkerOverlay();
                        _this.addMarker(new BMap.Point(lng, lat));
                        _this.addInfoWindow();
                        // 输入框赋值
                        var ele = $('#c-locate');
                        if(ele.length == 0) return;
                        ele.val( lng + ',' + lat);
                    }
                })
            },

            /**
             * 加载已有的覆盖物
             */
            loadMyOverlay: function () {
                var _this = this;
                var map = this.map;
                // this.clearAll();
                map.centerAndZoom(this.point, this.zoom); // 设置地图中心点
                // 创建多边形覆盖物
                var ply = new BMap.Polygon(this.myOverlay, this.styleOptions);
                this.myPolygon = ply;
                try { 
                    ply.enableEditing(); 
                    ply.name = 'duobianxing'; // 标记覆盖物类型,方便清除指定覆盖物时用
                } 
                catch (e) { };
                ply.addEventListener("lineupdate", function (e) { // 拖动边线进行编辑时监听事件
                    // console.log('覆盖物属性发生变化e:', e);
                    if(_this.clickTimes != 0) _this.drawMode = 'polygon'; // 全局赋值
                    _this.showLatLon(e.currentTarget.ha);
                })
                ply.addEventListener("mouseout", function(e){ // 鼠标离开多边形区域时的监听事件
                    // console.log('鼠标离开了e：', e)
                    _this.drawMode = 'hander'; // 全局赋值
                })
                // this.showLatLon(ply.getPath()); // 绘制完成时显示覆盖物点信息
                map.addOverlay(ply);
            },

            
            /**
             * 添加点标记
             * @param {BMap Point} ps_point 地理坐标点
             */
            addMarker: function(ps_point){
                var map = this.map;
                var markPoint = typeof ps_point == 'undefined' ? this.point : ps_point;
                // 添加点标记
                var iconUrl = this.image.path + this.image.icon,
                    iconSize = new BMap.Size(this.image.size, this.image.size),
                    iconOptions = {
                        // offset: new BMap.Size(0, 0),
                        // imageOffset: new BMap.Size(0, 0),
                        anchor: new BMap.Size(5, 10) // 图标的定位锚点。此点用来决定图标与地理位置的关系，是相对于图标左上角的偏移值，默认等于图标宽度和高度的中间值
                    };
                var markerOptions = { }
                if(this.image.enable){
                    markerOptions.icon = new BMap.Icon(iconUrl, iconSize, iconOptions);
                }
                var marker = new BMap.Marker(markPoint, markerOptions);
                marker.enableDragging();
                marker.name = 'dianbiaoji'; // 标记覆盖物类型,方便清除指定覆盖物时用
                map.addOverlay(marker);
                this.marker = marker;

                // 添加信息窗
                var lbText =  '<div class="bdLabel">' + this.caption + '</div>',
                    lbOptions = {
                        position: markPoint, // 指定文本标注所在的地理位置
                        // offset: new BMap.Size(30, -30) // 设置文本偏移量
                        width: 0,     // 宽度(220-730) 0 自动调整
                        maxWidth:500,  // 最大宽度(220-730)
                        height: 0,     // 高度(60-650) 0 自动调整
                        offset: { // 位置偏移
                            width: -40, 
                            height: -75
                        }
                    }
                var label = new BMap.Label(lbText, lbOptions);
                label.setStyle({
                    color: 'blue',
                    borderRadius: '5px',
                    borderColor: '#ccc',
                    padding: '10px',
                    fontSize: '16px',
                    height: '30px',
                    lineHeight: '30px',
                    fontFamily: '微软雅黑'
                })
                label.name = 'wenbenbiaozhu'; // 标记覆盖物类型,方便清除指定覆盖物时用
                marker.setLabel(label); // 绑定文本标注到点标记上
                map.addOverlay(label);
                setTimeout(function(){ // 更改文本标注样式
                    $('.bdLabel').parent().addClass('bdMarkerLabel');
                }, 0)
                this.label = label;
                this.dragMarker();

                // 坐标拾取器赋值
                if($('#c-locate').length != 0) $('#c-locate').val(this.center);
            },


            /**
             * 添加信息窗口
             */
            addInfoWindow: function(){
                if(!this.infos.enable) return;
                var map = this.map;
                var marker = this.marker;
                var infoOptions = {
                    width : this.infos.width, // 宽。单位像素，取值范围：0, 220 - 730
                    height: this.infos.height, // 高。单位像素，取值范围：0, 60 - 650
                    title : '<div class="bdInfoTitle">' + (this.infos.title == '' ? this.caption : this.infos.title) + '</div>', // 标题。支持HTML内容
	                message: this.infos.message // 短信内容(可选)。完整的短信内容包括：自定义部分+位置链接，不设置时，显示默认短信内容。短信内容最长为140个字
                }
                var infoContent = '<div class="bdInfoDescribe">' + this.infos.content + '</div>';
                var infoDow = new BMap.InfoWindow(infoContent, infoOptions);  // 创建信息窗口对象 
                marker.addEventListener(this.infos.method, function(){       
                    map.openInfoWindow(infoDow, this.point);
                })

                if(this.infos.method == 'mouseover'){
                    marker.addEventListener('mouseout', function(){       
                        map.closeInfoWindow()
                    })
                }
            },

            /*
            * 绘图切换事件，即当绘图工具切换到“拖动地图”模式(光标呈现为一只手)时
            */
            drawCursorHand: function(){
                var _this = this;
                var handDom = document.getElementsByClassName('BMapLib_hander')[0],
                    markDom = document.getElementsByClassName('BMapLib_marker')[0],
                    cirDom = document.getElementsByClassName('BMapLib_circle')[0],
                    lineDom = document.getElementsByClassName('BMapLib_polyline')[0],
                    plyDom =  document.getElementsByClassName('BMapLib_polygon')[0],
                    rectDom = document.getElementsByClassName('BMapLib_rectangle')[0];
                if(typeof handDom != 'undefined'){
                    handDom.onclick = function(){
                        _this.drawMode = 'hander';
                    }
                }
                if(typeof markDom != 'undefined'){
                    markDom.onclick = function(){
                        _this.drawMode = 'marker';
                    }
                }
                if(typeof cirDom != 'undefined'){
                    cirDom.onclick = function(){
                        _this.drawMode = 'circle';
                    }
                }
                if(typeof lineDom != 'undefined'){
                    lineDom.onclick = function(){
                        _this.drawMode = 'polyline';
                    }
                }
                if(typeof plyDom != 'undefined'){
                    plyDom.onclick = function(){
                        _this.drawMode = 'polygon';
                    }
                }
                if(typeof rectDom != 'undefined'){
                    rectDom.onclick = function(){
                        _this.drawMode = 'rectangle';
                    }
                }
            },

            /**
             * 拖动点标记事件
             */
            dragMarker: function(){
                // 拖拽点标记时会触发此事件
                var marker = this.marker;
                 marker.addEventListener('dragend', function(e){
                    var x = e.point.lng,
                        y = e.point.lat;
                    // console.log('x:',x, '\ny:',y)
                    var ele = $('#c-locate');
                    if(ele.length == 0) return;
                    ele.val( x + ',' + y);
                })
            },
            
            
            /**
             * 清除所有覆盖物
             */
            clearAll: function () {
                var r = confirm('确认清除所有覆盖物？');
                if(r !== true) return;
                var map = this.map;
                var overlays = this.overlays;
                for (var i = 0; i < overlays.length; i++) {
                    map.removeOverlay(overlays[i]);
                }
                this.overlays.length = 0
                map.removeOverlay(this.myPolygon);
                this.myPolygon = '';
            },

            
            /**
             * 清除点标记覆盖物
             */
            removeMarkerOverlay: function(){
                var map = this.map;
                var allOverlay = map.getOverlays();
                allOverlay.map(function(item){
                    if(item.name === 'dianbiaoji'){
                        map.removeOverlay(item);
                    }
                })
            },


            /**
             * 清除多边形覆盖物
             */
            removePolyOverlay: function(){
                var map = this.map;
                var allOverlay = map.getOverlays();
                allOverlay.map(function(item){
                    if(item.name === 'duobianxing'){
                        map.removeOverlay(item);
                    }
                })
            },
          

            /**
             * 显示覆盖物点坐标
             */
             showLatLon: function (a) {
                // console.log('a：', a)
                var len = a.length;
                var s = '';
                var arr = [];
                for (var i = 0; i < len - 1; i++) {
                    arr.push([a[i].lng, a[i].lat]);
                    s += '<li>' + a[i].lng + ',' + a[i].lat + '<span class="red" title="删除" onclick="bdChinaMap.delPoint(' + i + ')">X</span></li>';
                }
                this.overlaysCache = arr;
                $("#panelWrap")[0].innerHTML = '<ul>' + s + '</ul>';
            },


            /**
             * 删除覆盖物点坐标
             */
             delPoint: function (i) {
                if (this.overlaysCache.length <= 3) {
                    alert('不能再删除, 请保留3个以上的点.');
                    return;
                }
                this.overlaysCache.splice(i, 1);
                var a = this.overlaysCache;
                var newOverlay = [];
                for (var i in a) {
                    newOverlay.push(new BMap.Point(a[i][0], a[i][1]));
                }
                this.myOverlay = newOverlay;
                this.loadMyOverlay();
            },


            /**
             *取覆盖物的经纬度
             */
            getOverLay: function () {
                // var box = this.myPolygon ? this.myPolygon : this.overlays[this.overlays.length - 1];
                var box = this.overlays.length == 0 ? this.myPolygon : this.overlays[this.overlays.length - 1];
                var coordinateArr = typeof box == 'undefined' ? [] : typeof box.Ao == 'undefined' ? [] : box.Ao;
                // console.log('box:', box)
                console.log('最后一个覆盖物信息：', coordinateArr);
            },

            /**
             * 获取覆盖物个数
             */
            getCount: function () {
                var n = 0;
                if (this.myPolygon) {
                    n++;
                };
                if (this.overlays) {
                    n = n + this.overlays.length;
                };
                // console.log('当前覆盖物个数：', n);
            }
        };


        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        $(function(){

            //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
            //                                                   初始化设置
            //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
           
            //——————————————————————————————————————————
            //=====初始化地图宽高 add 20210621-1
            setDituSize();
            
            //——————————————————————————————————————————
            //=====检测窗口变化事件 edit 20210621-1
            $(window).on('resize', function(){
                setDituSize();
            });

            /**
             * 函数：设置地图宽高 edit 20210621-1
             * (高度一定要在设置,且不可在使用百分比进行设置,不然在.net服务器环境下地图可能不显示)
             */
            function setDituSize(){
                var winW = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth, // 浏览器宽
                    winH = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight; // 浏览器高
                // 整个区域
                var eleAll = $('.bdmap'),
                    allMargLeft = Math.ceil(parseFloat(eleAll.css('marginLeft'))),
                    allMargRight = Math.ceil(parseFloat(eleAll.css('marginRight'))),
                    allPadLeft = Math.ceil(parseFloat(eleAll.css('paddingLeft'))),
                    allPadRight = Math.ceil(parseFloat(eleAll.css('paddingRight'))),
                    allMargTop = Math.ceil(parseFloat(eleAll.css('marginTop'))),
                    allMargBot = Math.ceil(parseFloat(eleAll.css('marginBottom'))),
                    allPadTop = Math.ceil(parseFloat(eleAll.css('paddingTop'))),
                    allPadBot = Math.ceil(parseFloat(eleAll.css('paddingBottom')));
                //  console.log('整个区域\nMargin左边距：', allMargLeft, '\nMargin右边距：',allMargRight, '\nPadding左边距：',allPadLeft, '\nPadding右边距：',allPadRight, '\nMargin上边距：', allMargTop, '\nMargin下边距：',allMargBot, '\nPadding上边距：',allPadTop, '\nPadding下边距：',allPadBot);
                // 顶部区域
                var eleTop = $('.bdmap__editor'),
                    topHeight = eleTop.outerHeight(true);
                // 地图区域
                var eleTu = $('.bdmap__map'),
                    tuMargTop = Math.ceil(parseFloat(eleTu.css('marginTop'))),
                    tuMargLeft = Math.ceil(parseFloat(eleTu.css('marginLeft'))),
                    tuMargRight = Math.ceil(parseFloat(eleTu.css('marginRight'))),
                    tuPadLeft = Math.ceil(parseFloat(eleTu.css('paddingLeft'))),
                    tuPadRight = Math.ceil(parseFloat(eleTu.css('paddingRight')));
                    tuMargTop = Math.ceil(parseFloat(eleTu.css('marginTop'))),
                    tuMargBot = Math.ceil(parseFloat(eleTu.css('marginBottom'))),
                    tuPadTop = Math.ceil(parseFloat(eleTu.css('paddingTop'))),
                    tuPadBot = Math.ceil(parseFloat(eleTu.css('paddingBottom')));
                // 计算宽高
                var allWidth = $('body').width() - (allMargLeft + allMargRight + allPadLeft + allPadRight),
                    allHeight = $('body').height() -  (allMargTop + allMargBot + allPadTop + allPadBot),
                    tuWidth = allWidth - (tuMargLeft + tuMargRight + tuPadLeft + tuPadRight),
                    tuHeight = allHeight - topHeight - (tuMargTop + tuMargBot + tuPadTop + tuPadBot);
                // console.log('bodyWidth：', $('body').width(), '\nallMargLeft:',allMargLeft, '\nallMargRight:',allMargRight, '\nallPadLeft:',allPadLeft, '\nallPadRight:', allPadRight);
                // console.log('tuMargLeft:',tuMargLeft, '\ntuPadLeft:',tuPadLeft, '\ntuPadLeft:',tuPadLeft, '\ntuPadRight:',tuPadRight);
                // console.log('--------------------------------');
                // 设置地图宽高
                $('.bdmap__map').css({
                    width: tuWidth,
                    height: tuHeight
                })
                $('#map').css({
                    width: eleTu.width(),
                    height: eleTu.height()
                })
            }

            
            //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
            //                                                   权限控制
            //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
            //——————————————————————————————————————————
            //=====后台返回审核状态 edit 20210710-1
            var checkJson = {
                "return":"ok", "data":[
                    {"check_sh":"0"}
                ]
            }
            /*
            //START AJAX
            var checkJson = {}
            var isHoldOn = true;
            ajax({
                heading: "获取学校审核状态",
                debug: false,
                async: false, // 取数方式. true 异步, false 同步(默认)
                type: "GET",
                dataType: "html",
                cache: false,
                url: "../fwh_pub/jk_xuexiao_xq.ashx",
                data: {
                    "action": "wh_xuexiao_check_sh_sel",
                    "menu_bh": "<%=s_menu_bh%>",
                    "user": "<%=s_user%>",
                    "sjk": "<%=s_sjk%>",
                    "xuexiao_bh": g_xuexiao_bh
                },
                success: function(res){
                    if(toolTip.mistakeTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                    // if(res == '') return;
                    checkJson = JSON.parse(res);
                },
                error: function(res){
                    if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                },
                beforeSend: function(XMLHttpRequest){ },
                complete: function(XMLHttpRequest, textStatus){ }
            })
            if(!isHoldOn){
                return;
            }
            //END AJAX
            */

             // 已审核的记录不显示操作区域
            if(typeof checkJson.data != 'undefined'){ 
                if(parseInt(checkJson.data[0]["check_sh"]) == 1){
                    $('#btn-pick-save, #btn-poly-del, #btn-poly-save, .bdmap__mouse').remove();
                    $('.bdmap__picker label').css({
                        display: 'block',
                        marginTop: '15px',
                        color: '#ff0000'
                    }).text('注意：当前学校已审核，无法进行学校地址坐标、学区坐标的更改与删除操作，如需进行这些操作，请联系审核人取消审核！');
                }
            }




            //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
            //                                                   创建学校坐标、学区范围
            //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
            //——————————————————————————————————————————
            //======后台返回学校坐标数据 edit 20210622-1
            var schoolJson = {
                "return":"ok", "data":[
                    {"xuexiao_bh":"X1001", "xuexiao_mc":"泉州五中", "xuexiao_ms":"泉州五中是泉州市最好的学校", "zuobiao":"118.611836,24.918225", "ditu_suofang":"15"}
                ]
            }
            /*
            //START AJAX
            var schoolJson = {}
            var isHoldOn = true;
            ajax({
                heading: "获取学校坐标",
                debug: false,
                async: false, // 取数方式. true 异步, false 同步(默认)
                type: "GET",
                dataType: "html",
                cache: false,
                url: "../fwh_pub/jk_xuexiao_xq.ashx",
                data: {
                    "action": "wh_xuexiao_query_one",
                    "menu_bh": "<%=s_menu_bh%>",
                    "user": "<%=s_user%>",
                    "sjk": "<%=s_sjk%>",
                    "xuexiao_bh": g_xuexiao_bh
                },
                success: function(res){
                    if(toolTip.mistakeTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                    // if(res == '') return;
                    schoolJson = JSON.parse(res);
                },
                error: function(res){
                    if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                },
                beforeSend: function(XMLHttpRequest){ },
                complete: function(XMLHttpRequest, textStatus){ }
            })
            if(!isHoldOn){
                return;
            }
            //END AJAX
            */

            // 全局赋值
            var firstRowData = schoolJson.data[0];
            // g_xuexiao_bh = firstRowData["xuexiao_bh"];
            g_xuexiao_mc = firstRowData["xuexiao_mc"];
            g_zhongxin_zb = firstRowData["zuobiao"];
            g_ditu_suofang = firstRowData["ditu_suofang"]; // add 20210622-1



            //——————————————————————————————————————————
            //======后台返回学区坐标数据
            var coordinateJson = { // 泉州市点坐标数组
                "return":"ok",
                "data":[
                    { "weizhi":"1001", "data":[
                        {"zuobiao":"118.599547, 24.9246154"},
                        {"zuobiao":"118.607812, 24.9197654"},
                        {"zuobiao":"118.594948, 24.91308"}
                    ]},
                    { "weizhi":"1002", "data":[
                        {"zuobiao":"118.602206, 24.914588"},
                        {"zuobiao":"118.612986, 24.912294"},
                        {"zuobiao":"118.606302, 24.906198"},
                        {"zuobiao":"118.601991, 24.904035"},
                        {"zuobiao":"118.598829, 24.908361"},
                        {"zuobiao":"118.598829, 24.908361"}
                    ]}
                ]
            }
            /*
            //START AJAX
            var coordinateJson = {}
            var isHoldOn = true;
            ajax({
                heading: "获取学区坐标",
                debug: false,
                async: false, // 取数方式. true 异步, false 同步(默认)
                type: "GET",
                dataType: "html",
                cache: false,
                url: "../fwh_pub/jk_xuexiao_xq.ashx",
                data: {
                    "action": "wh_xuexiao_xq_zuobiao_query_one",
                    "menu_bh": "<%=s_menu_bh%>",
                    "user": "<%=s_user%>",
                    "sjk": "<%=s_sjk%>",
                    "xuexiao_bh": g_xuexiao_bh
                },
                success: function(res){
                    if(toolTip.mistakeTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                    // if(res == '') return;
                    coordinateJson = JSON.parse(res);
                },
                error: function(res){
                    if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                },
                beforeSend: function(XMLHttpRequest){ },
                complete: function(XMLHttpRequest, textStatus){ }
            })
            if(!isHoldOn){
                return;
            }
            //END AJAX
            */


            // 将坐标数据转化经纬度坐标数组
            /*
            * 转化后的格式示例eg：
                var coordinateArray = [
                    [
                        new BMap.Point(116.256515, 39.995242),
                        new BMap.Point(116.502579, 39.951893),
                        new BMap.Point(116.256515, 39.866882)
                    ],
                    [
                        new BMap.Point(116.264158, 40.31587),
                        new BMap.Point(116.280256, 40.188118),
                        new BMap.Point(116.417086, 40.189882)
                    ]
                ]
            */
            var coordinateArray = [ ];
            if(typeof coordinateJson.data != 'undefined'){
                for(var i1 = 0; i1 < coordinateJson.data.length; i1++){
                    var item1 = coordinateJson.data[i1];
                    var arr = [ ];
                    if(typeof item1.data != 'undefined'){
                        for(var i2 = 0; i2 < item1.data.length; i2++){
                            var item2 = item1.data[i2];
                            var zb = item2.zuobiao;
                            var tmpArr = item2.zuobiao.split(','),
                                lng= tmpArr[0], lat = tmpArr[1];
                            arr.push(new BMap.Point(lng, lat));
                        }
                    }
                    coordinateArray.push(arr);
                }
            }


            //——————————————————————————————————————————
            //=====地图初始化 edit 20210621-1 20210622-1
            // console.log('overlayArrray:', coordinateArray)
            bdChinaMap.center = g_zhongxin_zb; // '118.611836,24.918225'; // 中心点坐标
            bdChinaMap.caption = g_xuexiao_mc; // '泉州市'; // 中心点说明文字
            bdChinaMap.zoom = g_ditu_suofang == '' ? 15 : g_ditu_suofang; // 缩放级别
            bdChinaMap.image.enable = true;
            bdChinaMap.image.icon = 'bmap_school.png';
            bdChinaMap.clickCreateNewCenter = true; // 是否启用点击地图时在点击位置新建中心点坐标 add 20210712-1
            // bdChinaMap.infos.enable = false;
            // bdChinaMap.infos.method = 'click';
            // bdChinaMap.infos.content = '这里填写地址';
            bdChinaMap.default.enableMapClick = false; // 是否启用底图景点可点功能 add 20210622-1

            // // 1、加载一个已有的多边形
            // bdChinaMap.myOverlay = [
            //     new BMap.Point(116.256515, 39.995242),
            //     new BMap.Point(116.502579, 39.951893),
            //     new BMap.Point(116.256515, 39.866882)
            // ];
            // bdChinaMap.init();
            // 2、加载多个已有的多边形
            bdChinaMap.myPoints = coordinateArray;     
            bdChinaMap.init();



            //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
            //                                                   系列点击事件
            //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
            //——————————————————————————————————————————
            //=====显示结果面板动作、编辑多边形
            var isPanelShow = false;
            $("#showPanelBtn").on('click', function(){
                if (isPanelShow == false) {
                    isPanelShow = true;
                    $("#showPanelBtn")[0].style.right = "230px";
                    $("#panelWrap")[0].style.width = "230px";
                    $("#map")[0].style.marginRight = "230px";
                    $("#showPanelBtn")[0].innerHTML = "编辑多边形<br/>>";
                } else {
                    isPanelShow = false;
                    $("#showPanelBtn")[0].style.right = "0px";
                    $("#panelWrap")[0].style.width = "0px";
                    $("#map")[0].style.marginRight = "0px";
                    $("#showPanelBtn")[0].innerHTML = "编辑多边形<br/><";
                }
            });


            //——————————————————————————————————————————
            //=====绘制学区范围步骤显示或隐藏 add 20210621-1
            $('.bdmap__mouse-title').on('click', function(){
                var $this = $(this);
                var $next = $(this).next();
                if($next.is(':visible')){
                    $this.addClass('angle-down');
                    $next.slideUp('fast');
                }else{
                    $this.removeClass('angle-down');
                    $next.slideDown('fast');
                }
            });





            //——————————————————————————————————————————
            //=====复制按钮、复制当前坐标
            $('#btn-pick-copy').on('click', function(){
                var $text = $(this).siblings('#c-locate')
                var value = $text.val();
                $text[0].select();
                document.execCommand("Copy"); // 执行浏览器复制命令
                var tips = '已复制好，可贴粘！';
                // alert(tips);
                neuiDialog.notice({
                    message: tips,
                    theme: 'black',
                    maskOpacity: 1
                })
            });





            //——————————————————————————————————————————
            //=====保存学校坐标按钮
            $('#btn-pick-save').on('click', function(){
                var ls_zuobiao = $('#c-locate').val();
                var arr = [ ls_zuobiao ]
                // console.log('数组：', arr);

                // 开始执行
                var flag = '', msg = '保存成功';
                neui.showAnimate();
                setTimeout(function(){
                    //后台返回
                    /*
                    //START AJAX
                    var isHoldOn = true;
                    ajax({
                        heading: "保存学校坐标",
                        debug: false,
                        async: false, // 取数方式. true 异步, false 同步(默认)
                        type: "GET",
                        dataType: "html",
                        cache: false,
                        url: "../fwh_pub/jk_xuexiao_xq.ashx",
                        data: {
                            "action": "wh_xuexiao_zuobiao_ins",
                            "menu_bh": "<%=s_menu_bh%>",
                            "user": "<%=s_user%>",
                            "sjk": "<%=s_sjk%>",
                            "xuexiao_bh": g_xuexiao_bh,
                            "zuobiao": ls_zuobiao
                        },
                        success: function(res){
                            if(toolTip.emptyTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                            var json = JSON.parse(res);
                            flag = json.return == 'ok' ? 1 : 0;
                            if(!flag) msg = json.data;
                        },
                        error: function(res){
                            if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                        },
                        beforeSend: function(XMLHttpRequest){ },
                        complete: function(XMLHttpRequest, textStatus){ }
                    })
                    if(!isHoldOn){
                        neui.destroyAnimate();
                        return;
                    }
                    //END AJAX
                    */
                    flag = parseInt(1); //1 成功, 0 失败
                    if(!flag) msg = '保存失败';

                    neuiDialog.alert({
                        caption: '提示',
                        message: msg,
                        buttons: ['确定']
                    })
                    neui.destroyAnimate();
                }, 100)
            });




            
            //——————————————————————————————————————————
            //=====保存学区范围按钮
            $('#btn-poly-save').on('click', function(){
                // edit 20210622-1 下8行
                var ls_ditu_suofang = tools.getZoom(); // 获取地图缩放级别
                // console.log('当前地图缩放级别：', ls_ditu_suofang);
                var coordArr = tools.getPolyCoordinateData();  // 获取学区范围坐标数据
                // console.log('保存时coordArr：', coordArr);
                // 开始执行
                var marks = '', tips = '保存地图缩放级别成功';
                var flag = '', msg = '保存成功';
                neui.showAnimate();
                setTimeout(function(){

                    // 1. 保存地图缩放级别 add 20210622-1
                    // 后台返回
                    /*
                    // START AJAX
                    var isHoldOn = true;
                    ajax({
                        heading: "保存地图缩放级别",
                        debug: false,
                        async: false, // 取数方式. true 异步, false 同步(默认)
                        type: "GET",
                        dataType: "html",
                        cache: false,
                        url: "../fwh_pub/jk_xuexiao_xq.ashx",
                        data: {
                            "action": "wh_xuexiao_ditu_suofang_ins",
                            "menu_bh": "<%=s_menu_bh%>",
                            "user": "<%=s_user%>",
                            "sjk": "<%=s_sjk%>",
                            "xuexiao_bh": g_xuexiao_bh,
                            "ditu_suofang": ls_ditu_suofang
                        },
                        success: function(res){
                            if(toolTip.emptyTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                            var json = JSON.parse(res);
                            marks = json.return == 'ok' ? 1 : 0;
                            if(!marks) tips = json.data;
                        },
                        error: function(res){
                            if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                        },
                        beforeSend: function(XMLHttpRequest){ },
                        complete: function(XMLHttpRequest, textStatus){ }
                    })
                    if(!isHoldOn){
                        neui.destroyAnimate();
                        return;
                    }
                    // END AJAX
                    */
                    marks = parseInt(1); // 1 成功, 0 失败
                    if(!marks) tips = '保存地图缩放级别失败';
    
                    if(!marks){ // 失败才提示
                        neuiDialog.alert({
                            caption: '提示',
                            message: tips,
                            buttons: ['确定']
                        })
                        neui.destroyAnimate();
                        return;
                    }


                    // 2、保存学区坐标
                    for(var i = 0; i < coordArr.length; i++){
                        var row = coordArr[i];
                        var xuhao = "100" + (i + 1); // eg.1001, 1002, 1003, ...
                            data = row;
                        var saveArr1 = [ xuhao, data ]
                        // console.log('外部行循环数组:', saveArr1);
                        var isGoOn = true; // 是否继续循环, true 是, false 否
                        for(var k = 0; k < data.length; k++){
                            var ls_weizhi = xuhao,
                                ls_zuobiao = data[k],
                                ls_counts = i == 0 && k == 0 ? 0 : ''; // 第一行传0，其它传空
                            var saveArr2 = [ ls_weizhi, ls_zuobiao, ls_counts ]
                            // console.log('内部行循环数组：', saveArr2);

                            // 后台返回
                            /*
                            // START AJAX
                            var isHoldOn = true;
                            ajax({
                                heading: "保存学区坐标",
                                debug: false,
                                async: false, // 取数方式. true 异步, false 同步(默认)
                                type: "GET",
                                dataType: "html",
                                cache: false,
                                url: "../fwh_pub/jk_xuexiao_xq.ashx",
                                data: {
                                    "action": "wh_xuexiao_xq_zuobiao_ins",
                                    "menu_bh": "<%=s_menu_bh%>",
                                    "user": "<%=s_user%>",
                                    "sjk": "<%=s_sjk%>",
                                    "xuexiao_bh": g_xuexiao_bh,
                                    "weizhi": ls_weizhi,
                                    "zuobiao": ls_zuobiao,
                                    "counts": ls_counts
                                },
                                success: function(res){
                                    if(toolTip.emptyTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                                    var json = JSON.parse(res);
                                    flag = json.return == 'ok' ? 1 : 0;
                                    if(!flag) msg = json.data;
                                },
                                error: function(res){
                                    if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                                },
                                beforeSend: function(XMLHttpRequest){ },
                                complete: function(XMLHttpRequest, textStatus){ }
                            })
                            if(!isHoldOn){
                                neui.destroyAnimate();
                                // return;
                                // 注意：在for循环中要这样写,才能在后台错误时中断执行 add 20210621-1 下2行
                                flag = 0; // 1 成功, 0 失败
                                isGoOn = false;
                            }
                            // END AJAX
                            */
                            flag = parseInt(1); // 1 成功, 0 失败
                            if(!flag) msg = '保存失败';

                            if(!flag){
                                isGoOn = false;
                                break;
                            }
                        } // END 内层FOR

                        if(!isGoOn) break;
                    } // END 外层FOR

                    neuiDialog.alert({
                        caption: '提示',
                        message: msg,
                        buttons: ['确定']
                    })
                    neui.destroyAnimate();
                }, 100)
            });





            //——————————————————————————————————————————
            //=====删除学区范围按钮
            $('#btn-poly-del').on('click', function(){
                neuiDialog.alert({
                    animate: true,
                    caption: '提示',
                    message: '确认删除学区范围？',
                    buttons: ['确定', '取消'],
                    callBack: function(ret){
                        if(ret == 1){
                            // 获取学区范围坐标数据
                            var coordArr = tools.getPolyCoordinateData();
                            // console.log('删除时coordArr：', coordArr);
                            // 开始执行
                            var flag = '', msg = '删除成功';
                            neui.showAnimate();
                            setTimeout(function(){
                                //后台返回
                                /*
                                //START AJAX
                                var isHoldOn = true;
                                ajax({
                                    heading: "删除学区坐标",
                                    debug: false,
                                    async: false, // 取数方式. true 异步, false 同步(默认)
                                    type: "GET",
                                    dataType: "html",
                                    cache: false,
                                    url: "../fwh_pub/jk_xuexiao_xq.ashx",
                                    data: {
                                        "action": "wh_xuexiao_xq_zuobiao_del",
                                        "menu_bh": "<%=s_menu_bh%>",
                                        "user": "<%=s_user%>",
                                        "sjk": "<%=s_sjk%>",
                                        "xuexiao_bh": g_xuexiao_bh
                                    },
                                    success: function(res){
                                        if(toolTip.emptyTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                                        var json = JSON.parse(res);
                                        flag = json.return == 'ok' ? 1 : 0;
                                        if(!flag) msg = json.data;
                                    },
                                    error: function(res){
                                        if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                                    },
                                    beforeSend: function(XMLHttpRequest){ },
                                    complete: function(XMLHttpRequest, textStatus){ }
                                })
                                if(!isHoldOn){
                                    neui.destroyAnimate();
                                    return;
                                }
                                //END AJAX
                                */
                                flag = parseInt(1); //1 成功, 0 失败
                                if(!flag) msg = '删除失败';

                                neuiDialog.alert({
                                    caption: '提示',
                                    message: msg,
                                    buttons: ['确定'],
                                    callBack: function(){
                                        if(flag){ //成功
                                            tools.removePolyOverlay(); // 清除多边形覆盖物
                                        }
                                    }
                                })

                                neui.destroyAnimate();
                            }, 100)
                        }
                    }
                })
            });




        }); // $(function(){})
    </script>
</body>
</html>