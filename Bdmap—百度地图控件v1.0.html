<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="网站名称">
    <meta name="applicable-device" content="pc,mobile">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <title>neuiBdmap | 百度地图控件</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link type="text/css" rel="stylesheet" href="assets/neatui/css/neatui.min.css"><!--前端框架-->
    <link type="text/css" rel="stylesheet" href="assets/neatui/css/neatui-dialog.css"><!--对话框-->
    <link type="text/css" rel="stylesheet" href="assets/neatui/css/neatui-bdmap.css?v=20241121-5"><!--百度地图控件-->
    <link type="text/css" rel="stylesheet" href="assets/style/css/bd_zuobiao_fanwei.css?v=20241121-5"><!--当前页面样式-->
</head>

<body>

    <style>
        /*隐藏百度地图版权信息*/
        .BMap_cpyCtrl { display: none; }
        .anchorBL { display: none; }
         /*+-------------------------+*/
        .bdmap__picker>div{ display: inline-block; vertical-align: top; margin-left: 35px; }
        .bdmap__picker>div:first-child{ margin-left: 0; }
    </style>

    <div class="bdmap" id="allmap">
        <div class="bdmap__editor">
            <div class="bdmap__picker">
                <div class="bdmap__coord">
                    当前学校坐标 <input type="text" id="c-locate">
                    <button type="button" data-type="copy" id="btn-pick-copy">复制</button>
                    <button type="button" data-type="save" id="btn-pick-save">保存学校坐标</button>
                    <label> (拖动点标记可更改坐标) </label>
                </div><!--/.bdmap__coord-->
                <div class="bdmap__btn">
                    <button type="button" data-type="del" id="btn-poly-del">删除学区范围</button>
                    <button type="button" data-type="save" id="btn-poly-save">保存学区范围</button>
                </div><!--/.bdmap__btn-->
                <div class="bdmap__locate">
                    <label>陌生小区，边界难画？请使用：</label>
                    <button type="button" data-type="save" id="btn-locate">地点定位</button>
                </div><!--/.bdmap__locate-->
            </div><!--/.bdmap__picker-->
            <div class="bdmap__draw"></div><!--/.bdmap__draw-->
        </div><!--/.bdmap__editor-->
        <div class="bdmap__map">
            <div id="map"></div>
          
            <div id="showPanelBtn">编辑多边形&lt;</div>
            <div id="panelWrap">
                <div id="showOverlayInfo">此处用于展示覆盖物信息</div>
                <div id="panel"></div>
            </div>
        </div><!--/.bdmap__map-->
    </div><!--/.allmap-->
    
    <div id="result">
        <dl>
            <dt>绘制工具功能</dt>
            <dd>
                <ul>
                    <li><label><input type="radio" name="openClose1" onclick="bdChinaMap.drawingManager.open()" />打开</label>
                        <label><input type="radio" name="openClose1" onclick="bdChinaMap.drawingManager.close()" checked="checked" />关闭</label></li>
                </ul>
            </dd>

            <dt>是否进行线或面积的计算(单位米)</dt>
            <dd>
                <ul>
                    <li>
                        <label><input type="radio" name="openClose" onclick="bdChinaMap.drawingManager.enableCalculate()">打开</label> 
                        <label><input type="radio" name="openClose" onclick="bdChinaMap.drawingManager.disableCalculate()" checked="checked">关闭</label>
                    </li>
                </ul>
            </dd>

            <dt>绘制功能</dt>
            <dd>
                <ul>
                    <li>
                        <label><input type="radio" name="drawmode"  onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_MARKER)" checked="checked">画点</label>
                        <input type="checkbox" id="isInfowindow"> 是否带信息窗口
                    </li>
                    <li>
                        <label><input type="radio" name="drawmode" onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_CIRCLE)">画圆</label>
                    </li>
                    <li>
                        <label><input type="radio" name="drawmode" onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_POLYLINE)">画线</label>
                    </li>
                    <li>
                        <label><input type="radio" name="drawmode" onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_POLYGON)">画多边形</label>
                    </li>
                    <li>
                        <label><input type="radio" name="drawmode" onclick="bdChinaMap.drawingManager.setDrawingMode(BMAP_DRAWING_RECTANGLE)">画矩形</label>
                    </li>
                </ul>
            </dd>

            <dt>覆盖物操作</dt>
            <dd>
                <ul>
                    <li>
                        <input type="button" value="获取绘制的覆盖物个数" onclick="bdChinaMap.getCount()" />
                        <input type="button" value="清除所有覆盖物" onclick="bdChinaMap.clearAll()" />
                        <input type="button" value="获取最后一个覆盖物信息" onclick="bdChinaMap.getOverLay()" />
                    </li>
                </ul>
            </dd>
        </dl>
    </div>
    

    <!--================================================================================-->
    <!--                            JAVASCRIPT                                          -->
    <!--================================================================================-->
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=KmYpNYDatEVqdNvwvDXsbbOvQhTvPg9X"></script><!--百度地图api文件 (这里要屏蔽)-->
    <script type="text/javascript" src="assets/libs/bdmap.drawingManager.js"></script> <!--鼠标绘制工具 (这里要屏蔽)-->
    <script type="text/javascript" src="assets/libs/jquery-1.8.3.min.js"></script><!--Jq库-->
    <script type="text/javascript" src="assets/neatui/js/neatui.min.js"></script><!--前端框架-->
    <script type="text/javascript" src="assets/neatui/js/neatui-dialog.js"></script><!--对话框-->
    <script type="text/javascript" src="assets/neatui/js/neatui-ajax.js"></script><!--自定义ajax-->
    <script type="text/javascript" src="assets/neatui/js/neatui-bdmap.js?v=20241119-11"></script><!--自定义ajax-->
    <script type="text/javascript">
        /*+————————————————全局变量————————————————+*/
        var g_xuexiao_bh = ''; // '<%=s_xuexiao_bh%>'; // 学校编号 ajax({})
        var g_xuexiao_mc = ''; // 学校名称
        var g_zhongxin_zb = ''; // 地图中心点坐标
        var g_ditu_suofang = ''; // 地图缩放级别
        


        //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
        //                                                   初始化
        //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
        
        //——————————————————————————————————————————
        // //=====初始化地图宽高 add 20210621-1
        // setDituSize();
        
        //——————————————————————————————————————————
        //=====检测窗口变化事件 edit 20210621-1
        // $(window).on('resize', function(){
        //     setDituSize();
        // });

        /**
         * 函数：设置地图宽高 edit 20210621-1
         * (高度一定要在设置,且不可在使用百分比进行设置,不然在.net服务器环境下地图可能不显示)
         */
        function setDituSize(){
            var winW = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth, // 浏览器宽
                winH = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight; // 浏览器高
            // 整个区域
            var eleAll = $('.bdmap'),
                allMargLeft = Math.ceil(parseFloat(eleAll.css('marginLeft'))),
                allMargRight = Math.ceil(parseFloat(eleAll.css('marginRight'))),
                allPadLeft = Math.ceil(parseFloat(eleAll.css('paddingLeft'))),
                allPadRight = Math.ceil(parseFloat(eleAll.css('paddingRight'))),
                allMargTop = Math.ceil(parseFloat(eleAll.css('marginTop'))),
                allMargBot = Math.ceil(parseFloat(eleAll.css('marginBottom'))),
                allPadTop = Math.ceil(parseFloat(eleAll.css('paddingTop'))),
                allPadBot = Math.ceil(parseFloat(eleAll.css('paddingBottom')));
            //  console.log('整个区域\nMargin左边距：', allMargLeft, '\nMargin右边距：',allMargRight, '\nPadding左边距：',allPadLeft, '\nPadding右边距：',allPadRight, '\nMargin上边距：', allMargTop, '\nMargin下边距：',allMargBot, '\nPadding上边距：',allPadTop, '\nPadding下边距：',allPadBot);
            // 顶部区域
            var eleTop = $('.bdmap__editor'),
                topHeight = eleTop.outerHeight(true);
            // 地图区域
            var eleTu = $('.bdmap__map'),
                tuMargTop = Math.ceil(parseFloat(eleTu.css('marginTop'))),
                tuMargLeft = Math.ceil(parseFloat(eleTu.css('marginLeft'))),
                tuMargRight = Math.ceil(parseFloat(eleTu.css('marginRight'))),
                tuPadLeft = Math.ceil(parseFloat(eleTu.css('paddingLeft'))),
                tuPadRight = Math.ceil(parseFloat(eleTu.css('paddingRight')));
                tuMargTop = Math.ceil(parseFloat(eleTu.css('marginTop'))),
                tuMargBot = Math.ceil(parseFloat(eleTu.css('marginBottom'))),
                tuPadTop = Math.ceil(parseFloat(eleTu.css('paddingTop'))),
                tuPadBot = Math.ceil(parseFloat(eleTu.css('paddingBottom')));
            // 计算宽高
            var allWidth = $('body').width() - (allMargLeft + allMargRight + allPadLeft + allPadRight),
                allHeight = $('body').height() -  (allMargTop + allMargBot + allPadTop + allPadBot),
                tuWidth = allWidth - (tuMargLeft + tuMargRight + tuPadLeft + tuPadRight),
                tuHeight = allHeight - topHeight - (tuMargTop + tuMargBot + tuPadTop + tuPadBot);
            // console.log('bodyWidth：', $('body').width(), '\nallMargLeft:',allMargLeft, '\nallMargRight:',allMargRight, '\nallPadLeft:',allPadLeft, '\nallPadRight:', allPadRight);
            // console.log('tuMargLeft:',tuMargLeft, '\ntuPadLeft:',tuPadLeft, '\ntuPadLeft:',tuPadLeft, '\ntuPadRight:',tuPadRight);
            // console.log('--------------------------------');
            // 设置地图宽高
            $('.bdmap__map').css({
                width: tuWidth,
                height: tuHeight
            })
            $('#map').css({
                width: eleTu.width(),
                height: eleTu.height()
            })
        }




        //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
        //                                                      获取数据
        //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
        //——————————————————————————————————————————
        //======后台返回学校坐标数据
        var schoolJson = {
            "return":"ok", "data":[
                {"xuexiao_bh":"X1001", "xuexiao_mc":"泉州五中", "xuexiao_ms":"泉州五中是泉州市最好的学校", "zuobiao":"118.611836,24.918225", "ditu_suofang":"15"}
            ]
        }
        /*
        //START AJAX
        var schoolJson = {}
        var isHoldOn = true;
        ajax({
            heading: "获取学校坐标",
            debug: false,
            async: false, // 取数方式. true 异步, false 同步(默认)
            type: "POST",
            dataType: "html",
            cache: false,
            url: "../fwh_pub/jk_xuexiao_xq.ashx",
            data: {
                "action": "wh_xuexiao_query_one",
                "menu_bh": "<%=s_menu_bh%>",
                "user": "<%=s_user%>",
                "sjk": "<%=s_sjk%>",
                "xuexiao_bh": g_xuexiao_bh
            },
            success: function(res){
                if(toolTip.mistakeTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                // if(res == '') return;
                schoolJson = JSON.parse(res);
            },
            error: function(res){
                if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
            },
            beforeSend: function(XMLHttpRequest){ },
            complete: function(XMLHttpRequest, textStatus){ }
        })
        if(!isHoldOn){
            return;
        }
        //END AJAX
        */

        // 全局赋值
        var firstRowData = schoolJson.data[0];
        g_xuexiao_mc = firstRowData["xuexiao_mc"];
        g_zhongxin_zb = firstRowData["zuobiao"];
        g_ditu_suofang = firstRowData["ditu_suofang"];
        

        //——————————————————————————————————————————
        //======后台返回学区坐标数据
        var coordinateJson = { // 泉州市点坐标数组
            "return":"ok",
            "data":[
                { "weizhi":"1001", "data":[
                    {"zuobiao":"118.599547, 24.9246154"},
                    {"zuobiao":"118.607812, 24.9197654"},
                    {"zuobiao":"118.594948, 24.91308"}
                ]},
                { "weizhi":"1002", "data":[
                    {"zuobiao":"118.602206, 24.914588"},
                    {"zuobiao":"118.612986, 24.912294"},
                    {"zuobiao":"118.606302, 24.906198"},
                    {"zuobiao":"118.601991, 24.904035"},
                    {"zuobiao":"118.598829, 24.908361"}
                ]},
                { "weizhi":"1003", "data":[
                    {"zuobiao":"118.609488,24.896851"},
                    {"zuobiao":"118.6093,24.89628"},
                    {"zuobiao":"118.608888,24.895311"},
                    {"zuobiao":"118.608403,24.895458"},
                    {"zuobiao":"118.608388,24.895506"},
                    {"zuobiao":"118.608567,24.895937"},
                    {"zuobiao":"118.608648,24.896178"},
                    {"zuobiao":"118.608675,24.896371"},
                    {"zuobiao":"118.608576,24.896412"},
                    {"zuobiao":"118.608504,24.896432"},
                    {"zuobiao":"118.608463,24.896507"},
                    {"zuobiao":"118.608428,24.896613"},
                    {"zuobiao":"118.60746,24.896912"},
                    {"zuobiao":"118.607594,24.897138"},
                    {"zuobiao":"118.607647,24.897144"},
                    {"zuobiao":"118.607719,24.897251"},
                    {"zuobiao":"118.608006,24.897612"},
                    {"zuobiao":"118.607292,24.898022"},
                    {"zuobiao":"118.607642,24.898518"},
                    {"zuobiao":"118.609593,24.897216"},
                    {"zuobiao":"118.609488,24.896851"}
                ]}
            ]
        }
        /*
        //START AJAX
        var coordinateJson = {}
        var isHoldOn = true;
        ajax({
            heading: "获取学区坐标",
            debug: false,
            async: false, // 取数方式. true 异步, false 同步(默认)
            type: "POST",
            dataType: "html",
            cache: false,
            url: "../fwh_pub/jk_xuexiao_xq.ashx",
            data: {
                "action": "wh_xuexiao_xq_zuobiao_query_one",
                "menu_bh": "<%=s_menu_bh%>",
                "user": "<%=s_user%>",
                "sjk": "<%=s_sjk%>",
                "xuexiao_bh": g_xuexiao_bh
            },
            success: function(res){
                if(toolTip.mistakeTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                // if(res == '') return;
                coordinateJson = JSON.parse(res);
            },
            error: function(res){
                if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
            },
            beforeSend: function(XMLHttpRequest){ },
            complete: function(XMLHttpRequest, textStatus){ }
        })
        if(!isHoldOn){
            return;
        }
        //END AJAX
        */


        // 将坐标数据转化经纬度坐标数组
        /*
        * 转化后的二维数组格式示例eg：
            var coordinateArray = [
                [
                    { lng: 116.256515, lat: 39.995242 },
                    { lng: 116.502579, lat: 39.951893 },
                    { lng: 116.256515, lat: 39.866882 }
                ],[
                    { lng: 116.264158, lat: 40.31587 },
                    { lng: 116.280256, lat: 40.188118 },
                    { lng: 116.417086, lat: 40.189882 }
                ]
            ]
        */
        var coordinateArray = [ ];
        if(typeof coordinateJson.data != 'undefined'){
            for(var i1 = 0; i1 < coordinateJson.data.length; i1++){
                var item1 = coordinateJson.data[i1];
                var arr = [ ];
                if(typeof item1.data != 'undefined'){
                    for(var i2 = 0; i2 < item1.data.length; i2++){
                        var item2 = item1.data[i2];
                        var zb = item2.zuobiao;
                        var tmpArr = item2.zuobiao.split(','),
                            lng = tmpArr[0], lat = tmpArr[1];
                        arr.push({
                            lng,
                            lat
                        });
                    }
                }
                coordinateArray.push(arr);
            }
        }

        // 将坐标数据转化成覆盖物标识符数组
        var identifyArray = [ ];
        if(typeof coordinateJson.data != 'undefined'){
            for(var i = 0; i < coordinateJson.data.length; i++){
                var item = coordinateJson.data[i];
                identifyArray.push(item["weizhi"]);
            }
        }





        //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
        //                                          百度地图上展示数据并进行交互操作
        //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
        //————————————————————————————————————————————————
        // 地图初始化参数
        var options = {
            // 编程语言环境(可选)。注：不同环境下地图展示与交互可能有不同,故可能需要区分下。
            environment: {
                language: '.net' // 语言类型(可选)： 默认.net。值： .net 即Csharp .aspx页面, .php即php页面
            },
           // 地图大小。width/height参数值：数值型或百分比类型(如1920, 1920px, 90%)表示具体的大小, 字符串型 auto 表示自动调整, fn 表示在setSize/onResize函数中设置。注：百分比值会转化成浏览器视窗大小*百分比值。
            width: 'auto', // 宽(可选)，默认auto
            height: 'auto', // 高(可选)，默认auto
            setSize: function(){ // 初始化设置地图大小的函数(可选)，默认null。优先权大于width/height参数。
                setDituSize();
            },
            onResize: function(){ // 窗口大小变化时设置地图的函数(可选)，默认null。优先权大于width/height参数。
                setDituSize();
            },
            zoom: g_ditu_suofang, // 地图缩放级别(可选)，默认11。 值：3-19
            // 中心点(可选)
            center: {
                city: "", // 城市(可选)，默认空。值：空时根据坐标定位, 非空时根据城市定位。eg.'泉州市', eg.'泉州市惠安县'。
                coordinate: g_zhongxin_zb,  // 坐标(可选)，默认为首都北京天安门广场的坐标, eg."经度,纬度"。
                caption: g_xuexiao_mc, // 标题文字(可选)，默认空。
                describe: "", // 描述文字(可选)，默认空。
                enableDrag: true, // 是否允许拖拽(可选)，默认false
                enableClickCreateNew: true, // 是否启用点击地图时在点击位置新建中心点坐标(可选)，默认false。
                // 用点击地图时在点击位置新建中心点坐标的回调函数(可选)，默认null。返回值e为当前点标记的经纬度 { lng: 经度, lat : 纬度}
                clickCallback: function(e){
                    $('#c-locate').val(e.lng + ',' + e.lat); // 输入框赋值
                },
                // 创建完成回调(可选)，默认null。返回值e为当前点标记的经纬度 { lng: 经度, lat : 纬度}
                complete: function(e){
                    $('#c-locate').val(e.lng + ',' + e.lat);
                },
                // 拖拽结束回调(可选)，默认null。返回值e为当前点标记的经纬度 { lng: 经度, lat : 纬度}
                dragEnd: function(e){
                    $('#c-locate').val(e.lng + ',' + e.lat);
                },
            },
           

            // 功能与配置项(可选)
            draft: { // 地图地图功能(可选)
                platOptions: { // 地图默认配置项(可选)。
                    enableMapClick: false, // 是否启用底图景点可点功能(可选)，默认false。
                    minZoom: 3, // 地图允许展示的最小级别
                    maxZoom: 19, // 地图允许展示的最大级别
                    // mapType: BMAP_NORMAL_MAP, // 地图类型，默认为BMAP_NORMAL_MAP (启用此会报错,原因未知)
                    enableHighResolution: true, // 是否启用使用高分辨率地图。在iPhone4及其后续设备上，可以通过开启此选项获取更高分辨率的底图，v1.2,v1.3版本默认不开启，v1.4默认为开启状态
                    enableAutoResize: true // 是否自动适应地图容器变化，默认启用
                },
                enableWheelZoom: true // 是否开启鼠标滚轮缩放功能，仅对PC上有效(可选)，默认true。
            },

            // 点标记功能(可选)
            markers: {
                markOptions: { // 点标记默认配置项(可选)。
                    image: { // 自定义图标(可选)
                        enable: true, // 是否允许自定义图标(可选)，默认false
                        path: "assets/neatui/img/", // 图片路径(可选)
                        icon: "bmap_school.png", // 图片名称(可选)
                        size: 50 // 图片大小(可选)
                    }
                }
            },
            infos: { // 信息窗口功能(可选)。
                enable: false, // 是否启用(可选)，默认false
                width: 0, // 宽(可选)。单位像素，取值范围：0, 220 - 730, 其中0表示自动调整宽
                height: 0, // 高(可选)。单位像素，取值范围：0, 60 - 650，其中0表示自动调整高
                method: "mouseover" // 打开方式(可选). mouseover 鼠标经过点标记时(默认)，click 鼠标点击点标记时        
            }
        }


        //————————————————————————————————————————————————
        // 创建地图并初始化
        neuiBdmap('map', options);



        //————————————————————————————————————————————————
        // 创建多边形覆盖物
        neuiBdmap.createPolygonOverlays({
            points: coordinateArray, // 多边形覆盖物坐标组成的二维数组，有N个多边形数组就有N个元素。
            // 格式：
            // [
            //     [ {lng: '', lat: ''}, {lng: '', lat: ''}, {lng: '', lat: ''}, ..], // 第1个多边形的N个点
            //     [ {lng: '', lat: ''}, {lng: '', lat: ''}, {lng: '', lat: ''}, ..],// 第2个多边形的M个点
            //     [ {lng: '', lat: ''}, {lng: '', lat: ''}, {lng: '', lat: ''}, ..] // 第3个多边形的L个点
            // ];
            hideValues: identifyArray, // 多边形覆盖物隐藏值组成的一维数组(可选)，默认空数组。格式：[1001, 1002, 1003]。注：当界面上对某个多边形进行操作需用到该多边形的"隐藏值ID字段"时,可把后端提供的N个多边形的"隐藏值ID字段"push到本参数数组里传递进来，界面可通过按钮中的data-bh属性取得该隐藏值。
            buttons: { // 按钮(可选)
                enable: true,  // 是否添加操作按钮(可选)，默认false
                text: '删除', // 操作按钮的文本，默认'删除'
                callback: function(e){  // 回调函数(可选)，默认null。返回值e { id: '隐藏值ID字段', polyLayId: '多边形覆盖物唯一标识符', btnLayId: '按钮覆盖物唯一标识符'}
                    console.log('e：', e);
                    var ls_data_bh = e.id,
                        ls_ply_uid = e.polyLayId,
                        ls_btn_uid = e.btnLayId;
                    fnDelOneSchoolArea(ls_data_bh, ls_ply_uid, ls_btn_uid);
                }
            },
            skinOptions: { // 外观配置项(可选)。
                strokeColor: "red", // 边线颜色(可选)，默认红色。
                fillColor: "red", // 填充颜色(可选)，默认红色。当参数为空时，圆形将没有填充效果。
                strokeWeight: 1, // 边线的宽度，以像素为单位(可选)，默认1px。
                strokeOpacity: 0.8, // 边线透明度，取值范围0-1(可选)，默认0.8。
                fillOpacity: 0.65,  // 填充的透明度，取值范围0-1(可选)，默认0.65。
                strokeStyle: "solid" // 边线的样式，solid或dashed(可选)，默认solid。
            }
        });




        //————————————————————————————————————————————————
        // 开启鼠标绘图功能
        neuiBdmap.createDrawingToolbar({
            enable: true, // 是否启用鼠标绘图功能(可选)，默认true。
            drawingModes : [  // 工具栏上可以选择出现的绘制模式(可选)，将需要显示的DrawingType以数组型形式传入，如[BMAP_DRAWING_MARKER, BMAP_DRAWING_CIRCLE] 将只显示画点和画圆的选项.
                // BMAP_DRAWING_MARKER, // 画点(画位置)
                // BMAP_DRAWING_CIRCLE, // 画圆
                BMAP_DRAWING_POLYLINE, // 画线
                BMAP_DRAWING_POLYGON, // 画多边形
                BMAP_DRAWING_RECTANGLE // 画矩形
            ],
            enableCalculate: false, // 绘制是否进行测距(画线时候)、测面(画圆、多边形、矩形)(可选)，默认false
            drawingOptions: { // 鼠标绘图配置项，即鼠标绘制管理类配置项(可选)。
                strokeColor: "red", // 边线颜色(可选)，默认红色。
                fillColor: "red", // 填充颜色(可选)，默认红色。当参数为空时，圆形将没有填充效果。
                strokeWeight: 1, // 边线的宽度，以像素为单位(可选)，默认1px。
                strokeOpacity: 0.8, // 边线透明度，取值范围0-1(可选)，默认0.8。
                fillOpacity: 0.65,  // 填充的透明度，取值范围0-1(可选)，默认0.65。
                strokeStyle: "solid" // 边线的样式，solid或dashed(可选)，默认solid。
            },
            operateButton: { // 操作按钮(可选)
                buttoned: true, // 是否添加操作按钮(可选)，默认false
                btnText: '删除本学区' // 操作按钮的文本(可选)，默认'删除'
            },
            stepDescription: { // 绘制步骤说明(可选)
                enable: true, // 是否启用功能(可选)，默认true
                title: '绘制学区步骤说明', // 标题(可选)，有默认值
                content: '', // 自定义详细的绘制步骤说明(可选)，默认空。支持HTML
            }
        });





         //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
        //                                          系列事件
        //————————————————————————————————————————————————————————————————————————————————————————————————————————————————
        //————————————————————————————————————————————————
        //——————————————————————————————————————————
        //=====复制按钮、复制当前坐标
        $('#btn-pick-copy').on('click', function(){
            var $text = $(this).siblings('#c-locate');
            var value = $text.val();
            $text[0].select();
            document.execCommand("Copy"); // 执行浏览器复制命令
            var tips = '已复制好，可贴粘！';
            // alert(tips);
            neuiDialog.notice({
                message: tips,
                theme: 'black',
                maskOpacity: 1
            })
        });



        //——————————————————————————————————————————
        //=====保存学校坐标按钮
        $('#btn-pick-save').on('click', function(){
            var ls_zuobiao = $('#c-locate').val();
            var arr = [ ls_zuobiao ]
            // console.log('数组：', arr);

            // 开始执行
            var flag = '', msg = '保存成功';
            neui.showAnimate();
            setTimeout(function(){
                //后台返回
                /*
                //START AJAX
                var isHoldOn = true;
                ajax({
                    heading: "保存学校坐标",
                    debug: false,
                    async: false, // 取数方式. true 异步, false 同步(默认)
                    type: "POST",
                    dataType: "html",
                    cache: false,
                    url: "../fwh_pub/jk_xuexiao_xq.ashx",
                    data: {
                        "action": "wh_xuexiao_zuobiao_ins",
                        "menu_bh": "<%=s_menu_bh%>",
                        "user": "<%=s_user%>",
                        "sjk": "<%=s_sjk%>",
                        "xuexiao_bh": g_xuexiao_bh,
                        "zuobiao": ls_zuobiao
                    },
                    success: function(res){
                        if(toolTip.emptyTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                        var json = JSON.parse(res);
                        flag = json.return == 'ok' ? 1 : 0;
                        if(!flag) msg = json.data;
                    },
                    error: function(res){
                        if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                    },
                    beforeSend: function(XMLHttpRequest){ },
                    complete: function(XMLHttpRequest, textStatus){ }
                })
                if(!isHoldOn){
                    neui.destroyAnimate();
                    return;
                }
                //END AJAX
                */
                flag = parseInt(1); //1 成功, 0 失败
                if(!flag) msg = '保存失败';

                neuiDialog.alert({
                    message: msg,
                    buttons: ['确定']
                })
                neui.destroyAnimate();
            }, 100)
        });




        
        //——————————————————————————————————————————
        //=====保存学区范围按钮
        $('#btn-poly-save').on('click', function(){
            var ls_ditu_suofang = neuiBdmap.getZoom(); // 获取地图缩放级别
            var coordArr = neuiBdmap.getPolyCoordinateData();  // 获取学区范围坐标数据
             // console.log('当前地图缩放级别：', ls_ditu_suofang);
            // console.log('保存时coordArr：', coordArr);
            // 开始执行
            var marks = '', tips = '保存地图缩放级别成功';
            var flag = '', msg = '保存成功';
            neui.showAnimate();
            setTimeout(function(){

                // 1. 保存地图缩放级别
                // 后台返回
                /*
                // START AJAX
                var isHoldOn = true;
                ajax({
                    heading: "保存地图缩放级别",
                    debug: false,
                    async: false, // 取数方式. true 异步, false 同步(默认)
                    type: "POST",
                    dataType: "html",
                    cache: false,
                    url: "../fwh_pub/jk_xuexiao_xq.ashx",
                    data: {
                        "action": "wh_xuexiao_ditu_suofang_ins",
                        "menu_bh": "<%=s_menu_bh%>",
                        "user": "<%=s_user%>",
                        "sjk": "<%=s_sjk%>",
                        "xuexiao_bh": g_xuexiao_bh,
                        "ditu_suofang": ls_ditu_suofang
                    },
                    success: function(res){
                        if(toolTip.emptyTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                        var json = JSON.parse(res);
                        marks = json.return == 'ok' ? 1 : 0;
                        if(!marks) tips = json.data;
                    },
                    error: function(res){
                        if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                    },
                    beforeSend: function(XMLHttpRequest){ },
                    complete: function(XMLHttpRequest, textStatus){ }
                })
                if(!isHoldOn){
                    neui.destroyAnimate();
                    return;
                }
                // END AJAX
                */
                marks = parseInt(1); // 1 成功, 0 失败
                if(!marks) tips = '保存地图缩放级别失败';

                if(!marks){ // 失败才提示
                    neuiDialog.alert({
                        message: tips,
                        buttons: ['确定']
                    })
                    neui.destroyAnimate();
                    return;
                }


                // 2、保存学区坐标
                for(var i = 0; i < coordArr.length; i++){
                    var row = coordArr[i];
                    var xuhao = "100" + (i + 1); // eg.1001, 1002, 1003, ...
                        data = row;
                    var saveArr1 = [ xuhao, data ]
                    // console.log('外部行循环数组:', saveArr1);
                    var isGoOn = true; // 是否继续循环, true 是, false 否
                    for(var k = 0; k < data.length; k++){
                        var ls_weizhi = xuhao,
                            ls_zuobiao = data[k],
                            ls_counts = i == 0 && k == 0 ? 0 : ''; // 第一行传0，其它传空
                        var saveArr2 = [ ls_weizhi, ls_zuobiao, ls_counts ]
                        // console.log('内部行循环数组：', saveArr2);

                        // 后台返回
                        /*
                        // START AJAX
                        var isHoldOn = true;
                        ajax({
                            heading: "保存学区坐标",
                            debug: false,
                            async: false, // 取数方式. true 异步, false 同步(默认)
                            type: "POST",
                            dataType: "html",
                            cache: false,
                            url: "../fwh_pub/jk_xuexiao_xq.ashx",
                            data: {
                                "action": "wh_xuexiao_xq_zuobiao_ins",
                                "menu_bh": "<%=s_menu_bh%>",
                                "user": "<%=s_user%>",
                                "sjk": "<%=s_sjk%>",
                                "xuexiao_bh": g_xuexiao_bh,
                                "weizhi": ls_weizhi,
                                "zuobiao": ls_zuobiao,
                                "counts": ls_counts
                            },
                            success: function(res){
                                if(toolTip.emptyTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                                var json = JSON.parse(res);
                                flag = json.return == 'ok' ? 1 : 0;
                                if(!flag) msg = json.data;
                            },
                            error: function(res){
                                if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                            },
                            beforeSend: function(XMLHttpRequest){ },
                            complete: function(XMLHttpRequest, textStatus){ }
                        })
                        if(!isHoldOn){
                            neui.destroyAnimate();
                            // return;
                            // 注意：在for循环中要这样写,才能在后台错误时中断执行
                            flag = 0; // 1 成功, 0 失败
                            isGoOn = false;
                        }
                        // END AJAX
                        */
                        flag = parseInt(1); // 1 成功, 0 失败
                        if(!flag) msg = '保存失败';

                        if(!flag){
                            isGoOn = false;
                            break;
                        }
                    } // END 内层FOR

                    if(!isGoOn) break;
                } // END 外层FOR

                neuiDialog.alert({
                    message: msg,
                    buttons: ['确定'],
                    callBack: function(){
                        if(flag){
                            // window.location.reload(); // 重载页面
                            neuiBdmap.reloadPageWhenCsharp();  // ASP.NET中 使用这个
                        }
                    }
                })
                neui.destroyAnimate();
            }, 100)
        });




        //————————————————————————————————————————————————
        /**
         * 删除一个学区范围、删除一个多边形区域
         * @param {string} ps_weizhi 学区编号
         * @param {string} ps_ply_uid 多边形覆盖物唯一标识符
         * @param {string} ps_btn_uid 多边形覆盖物上面的按钮唯一标识符
         */
         function fnDelOneSchoolArea(ps_weizhi, ps_ply_uid, ps_btn_uid){
            neuiDialog.alert({
                message: '确认删除当前学区范围？',
                buttons: ['确定', '取消'],
                callBack: function(ret){
                    if(ret == 1){
                        // 开始执行
                        var flag = '', msg = '删除成功';
                        neui.showAnimate();
                        setTimeout(function(){
                            //后台返回
                            /*
                            //START AJAX
                            var isHoldOn = true;
                            ajax({
                                heading: "删除单个学区范围",
                                debug: false,
                                async: false, // 取数方式. true 异步, false 同步(默认)
                                type: "POST",
                                dataType: "html",
                                cache: false,
                                url: "../fwh_pub/jk_xuexiao_xq.ashx",
                                data: {
                                    "action": "wh_xuexiao_xq_weizhi_del",
                                    "menu_bh": "<%=s_menu_bh%>",
                                    "user": "<%=s_user%>",
                                    "sjk": "<%=s_sjk%>",
                                    "xuexiao_bh": g_xuexiao_bh,
                                    "weizhi": ps_weizhi
                                },
                                success: function(res){
                                    if(toolTip.emptyTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                                    var json = JSON.parse(res);
                                    flag = json.return == 'ok' ? 1 : 0;
                                    if(!flag) msg = json.data;
                                },
                                error: function(res){
                                    if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                                },
                                beforeSend: function(XMLHttpRequest){ },
                                complete: function(XMLHttpRequest, textStatus){ }
                            })
                            if(!isHoldOn){
                                neui.destroyAnimate();
                                return;
                            }
                            //END AJAX
                            */
                            flag = parseInt(1); //1 成功, 0 失败
                            if(!flag) msg = '删除失败';

                            neuiDialog.alert({
                                //animate: true,
                                popup: flag ? false : true, // 成功不弹窗，失败才弹窗
                                message: msg,
                                buttons: ['确定'],
                                callBack: function(){
                                    if(flag){ //成功
                                        //..
                                        neuiBdmap.removeOnePolyOverlay([ps_ply_uid, ps_btn_uid]);
                                    }
                                }
                            })

                            neui.destroyAnimate();
                        }, 100)
                    }
                }
            })
        }



        //——————————————————————————————————————————
        //=====删除学区范围按钮、删除全部学区范围
        $('#btn-poly-del').on('click', function(){
            neuiDialog.alert({
                animate: true,
                message: '确认删除学区范围？',
                buttons: ['确定', '取消'],
                callBack: function(ret){
                    if(ret == 1){
                        // 获取学区范围坐标数据
                        var coordArr = neuiBdmap.getPolyCoordinateData();
                        // console.log('删除时coordArr：', coordArr);
                        // 开始执行
                        var flag = '', msg = '删除成功';
                        neui.showAnimate();
                        setTimeout(function(){
                            //后台返回
                            /*
                            //START AJAX
                            var isHoldOn = true;
                            ajax({
                                heading: "删除学区坐标",
                                debug: false,
                                async: false, // 取数方式. true 异步, false 同步(默认)
                                type: "POST",
                                dataType: "html",
                                cache: false,
                                url: "../fwh_pub/jk_xuexiao_xq.ashx",
                                data: {
                                    "action": "wh_xuexiao_xq_zuobiao_del",
                                    "menu_bh": "<%=s_menu_bh%>",
                                    "user": "<%=s_user%>",
                                    "sjk": "<%=s_sjk%>",
                                    "xuexiao_bh": g_xuexiao_bh
                                },
                                success: function(res){
                                    if(toolTip.emptyTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                                    var json = JSON.parse(res);
                                    flag = json.return == 'ok' ? 1 : 0;
                                    if(!flag) msg = json.data;
                                },
                                error: function(res){
                                    if(toolTip.wrongTips(res, this.url, this.heading, this.debug)) { isHoldOn = false; return; }
                                },
                                beforeSend: function(XMLHttpRequest){ },
                                complete: function(XMLHttpRequest, textStatus){ }
                            })
                            if(!isHoldOn){
                                neui.destroyAnimate();
                                return;
                            }
                            //END AJAX
                            */
                            flag = parseInt(1); //1 成功, 0 失败
                            if(!flag) msg = '删除失败';

                            neuiDialog.alert({
                                message: msg,
                                buttons: ['确定'],
                                callBack: function(){
                                    if(flag){ //成功
                                        neuiBdmap.clearAllPolyOverlay(); // 清除多边形覆盖物
                                    }
                                }
                            })

                            neui.destroyAnimate();
                        }, 100)
                    }
                }
            })
        });





        //——————————————————————————————————————————
        //=====地点定位按钮
        $('#btn-locate').on('click', function(){
            // 使用IFRAME打开
            var linkUrl = 'Bdmap—百度地图控件-示例1_学校地点定位（地点定位，获取城市住宅小区等地点边界）.html'; // ajax({})
            neui.openIframe({
                url: linkUrl,
                caption: '地点定位',
                // top: '1%',
                // width: '98%',
                // titleHeight: 45,
                // titleFontSize:'18px',
                // showCross: true,
                // crossDirection: 'right',
                closeCallBack: function(){ 
                    // window.location.reload(); // 重载页面
                    document.getElementById('btn-temp').click(); // ASP.NET中 使用这个
                }
            })
        });



    </script>
</body>
</html>